import{u as y}from"./AppLayout-9f94cfff.js";import{_ as g,o,d as n,a as i,F as _,g as p,n as u,i as v,t as r,e as c,p as f,l as x,b,b2 as k}from"./app-9b50b83a.js";const w={name:"Poll",props:{question:{type:String,required:!1},answers:{type:Array,required:!1},showResults:{type:Boolean,default:!1},showTotalVotes:{type:Boolean,default:!0},finalResults:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},submitButtonText:{type:String,default:"Submit"},customId:{type:Number,default:0},isComingSoon:{type:Boolean,default:!1},started_at:{type:String,default:null},closed_at:{type:String,default:null}},setup(){const{formatTimeAgoToNow:e,formatToDayDateString:s}=y();return{formatTimeAgoToNow:e,formatToDayDateString:s}},data(){return{visibleResults:JSON.parse(this.showResults)}},computed:{totalVotes(){let e=0;return this.answers.filter(s=>{!isNaN(s.votes)&&s.votes>0&&(e+=parseInt(s.votes))}),e},totalVotesFormatted(){return this.totalVotes.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},mostVotes(){let e=0;return this.answers.filter(s=>{!isNaN(s.votes)&&s.votes>0&&s.votes>=e&&(e=s.votes)}),e},calcAnswers(){return this.totalVotes===0?this.answers.map(e=>(e.percent="0%",e)):this.answers.filter(e=>(!isNaN(e.votes)&&e.votes>0?e.percent=Math.round(parseInt(e.votes)/this.totalVotes*100)+"%":e.percent="0%",e))},totalSelections(){return this.calcAnswers.filter(e=>e.selected).length}},methods:{handleMultiple(){let e=[];this.calcAnswers.filter(t=>{t.selected&&(t.votes++,e.push({value:t.value,votes:t.votes}))}),this.visibleResults=!0;let s={arSelected:e,totalVotes:this.totalVotes};this.customId&&(s.customId=this.customId),this.$emit("addvote",s)},handleVote(e){if(this.isComingSoon)return;if(this.multiple){e.selected===void 0&&console.log("Please add 'selected: false' on the answer object"),e.selected=!e.selected;return}this.$page.props.auth.user&&(e.votes++,e.selected=!0,this.visibleResults=!0);let s={value:e.value,votes:e.votes,totalVotes:this.totalVotes};this.customId&&(s.customId=this.customId),this.$emit("addvote",s)}}},V={class:"vue-poll"},S=["innerHTML"],C={class:"ans-cnt"},T=["onClick"],N=["innerHTML"],R=["textContent"],B=["innerHTML"],L=["textContent"],M=["innerHTML"],P={key:0,class:"text-gray-400 text-xs italic"},A={class:"flex justify-between items-baseline"},H=["textContent"],I={key:1,class:"text-gray-400 text-xs italic"},j=["textContent"];function q(e,s,t,h,d,a){return o(),n("div",V,[i("h3",{class:"qst dark:text-gray-300",innerHTML:t.question},null,8,S),i("div",C,[(o(!0),n(_,null,p(a.calcAnswers,(l,m)=>(o(),n("div",{key:m,class:u({ans:!0,[l.custom_class]:l.custom_class})},[t.finalResults?(o(),n(_,{key:1},[i("div",{class:u({"ans-voted final dark:text-gray-200":!0,selected:l.selected})},[l.percent?(o(),n("span",{key:0,class:"percent",textContent:r(l.percent)},null,8,L)):c("",!0),i("span",{class:"txt",innerHTML:l.text},null,8,M)],2),i("span",{class:u({"bg bg-cool-gray-200 dark:bg-cool-gray-700":!0,"bg-light-blue-300 dark:bg-light-blue-500":a.mostVotes==l.votes}),style:f({width:l.percent})},null,6)],64)):(o(),n(_,{key:0},[d.visibleResults?(o(),n("div",{key:1,class:u({"ans-voted dark:text-gray-200":!0,selected:l.selected})},[l.percent?(o(),n("span",{key:0,class:"percent",textContent:r(l.percent)},null,8,R)):c("",!0),i("span",{class:"txt",innerHTML:l.text},null,8,B)],2)):(o(),n("div",{key:0,class:u(["hover:bg-light-blue-100 dark:hover:bg-cool-gray-900",{"ans-no-vote noselect":!0,active:l.selected}]),onClick:v(Q=>a.handleVote(l),["prevent"])},[i("span",{class:"txt",innerHTML:l.text},null,8,N)],10,T)),i("span",{class:"bg bg-cool-gray-200 dark:bg-cool-gray-700",style:f({width:d.visibleResults?l.percent:"0%"})},null,4)],64))],2))),128))]),t.isComingSoon?(o(),n("div",P,r(e.__("Poll starting"))+" "+r(h.formatTimeAgoToNow(t.started_at)),1)):c("",!0),i("div",A,[t.showTotalVotes&&(d.visibleResults||t.finalResults)?(o(),n("div",{key:0,class:"votes",textContent:r(a.totalVotesFormatted+" votes")},null,8,H)):c("",!0),!t.isComingSoon&&t.closed_at&&!t.finalResults?(o(),n("div",I,r(e.__("Poll closing"))+" "+r(h.formatTimeAgoToNow(t.closed_at)),1)):c("",!0)]),!t.finalResults&&!d.visibleResults&&t.multiple&&a.totalSelections>0?(o(),n("a",{key:1,href:"#",class:"submit",onClick:s[0]||(s[0]=v((...l)=>a.handleMultiple&&a.handleMultiple(...l),["prevent"])),textContent:r(t.submitButtonText)},null,8,j)):c("",!0)])}const F=g(w,[["render",q]]),D={components:{Poll:F},props:{poll:Object,isListing:{type:Boolean,default:!1}},data(){return{options:this.poll}},methods:{addVote(e){this.poll.isComingSoon||this.$inertia.post(route("poll.vote",[this.poll.id,e.value]),null,{preserveState:!0,preserveScroll:!0})}}},z={key:0},O={class:"p-3 sm:px-5 bg-white dark:bg-cool-gray-800 rounded shadow"},E={key:0,class:"font-extrabold text-gray-800 dark:text-gray-200"},J={key:1,class:"font-extrabold text-gray-800 dark:text-gray-200"},G={class:"mt-3 text-gray-500 dark:text-gray-300"};function K(e,s,t,h,d,a){const l=x("poll");return t.poll?(o(),n("div",z,[i("div",O,[t.isListing?c("",!0):(o(),n("h3",E,r(e.__("Latest Poll")),1)),t.isListing?(o(),n("h3",J,r(e.__("Poll"))+" "+r(t.poll.id),1)):c("",!0),i("div",G,[b(l,k(d.options,{onAddvote:a.addVote}),null,16,["onAddvote"])])])])):c("",!0)}const X=g(D,[["render",K]]);export{X as P};
