import{I as T,u as M}from"./AppLayout-3157e4a2.js";import{_ as B}from"./UserDisplayname-3cf73060.js";import{_ as D,l as h,q as v,o as i,d as a,e as c,j as _,m as S,a as t,t as p,F as A,g as L,n as x,b as d,w as y,f as P,c as b,i as N,v as j,ac as V}from"./app-0e0bee07.js";const H={components:{Icon:T,UserDisplayname:B},props:{post:Object},setup(){const{purifyAndLinkifyText:e,formatTimeAgoToNow:r,formatToDayDateString:o}=M();return{purifyAndLinkifyText:e,formatTimeAgoToNow:r,formatToDayDateString:o}},data(){return{comments:null,loading:!0,loadingMore:!1,commentBody:"",submitting:!1,bodyerror:null,showLoadMoreCommentsButton:!0}},created(){axios.get(route("post.comment.index",this.post.id)).then(e=>{this.comments=e.data,this.comments.data.reverse()}).finally(()=>{this.loading=!1})},methods:{loadMoreComments(){return this.comments.next_page_url?(this.loadingMore=!0,axios(this.comments.next_page_url).then(e=>{this.comments={...e.data,data:[...e.data.data.reverse(),...this.comments.data]}}).finally(()=>this.loadingMore=!1)):(this.showLoadMoreCommentsButton=!1,Promise.resolve())},submitComment(){this.submitting||(this.submitting=!0,this.bodyerror=null,axios.post(route("post.comment.store",this.post.id),{comment:this.commentBody}).then(e=>{e.status===200&&(this.comments.data.push(e.data.data),this.commentBody="")}).catch(e=>{e.response.status===422?this.bodyerror=e.response.data.errors.comment[0]:this.bodyerror=e.response.data.message}).finally(()=>{this.submitting=!1,this.$nextTick(()=>{this.$refs.comment.focus()})}))}}},O={class:"flex flex-col"},z=t("hr",{class:"mt-0.5 dark:border-cool-gray-700"},null,-1),U={key:0,class:"flex justify-center p-4"},F=t("svg",{class:"w-5 h-5 mr-3 -ml-1 animate-spin text-light-blue-600 dark:text-light-blue-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),I=[F],K={class:"flex mt-3"},q={key:1,class:"flex flex-col mt-3 space-y-2"},E={class:"items-start order-2 max-w-lg mx-2 space-y-2 text-sm"},W=["title"],G=["innerHTML"],J=["src"],Q={key:2,class:"flex mt-1"},R=["src"],X={class:"flex-grow order-2 mx-2 text-sm"},Y=["disabled","placeholder"],Z={key:0,class:"ml-2 text-xs text-red-500"};function $(e,r,o,u,s,l){const w=h("user-displayname"),g=h("inertia-link"),f=h("icon"),C=v("tippy"),k=v("confirm");return i(),a("div",O,[z,s.loading||s.loadingMore?(i(),a("div",U,I)):c("",!0),_(t("div",K,[t("button",{class:"text-sm font-semibold text-gray-500 dark:text-gray-400 focus:outline-none hover:underline",onClick:r[0]||(r[0]=(...n)=>l.loadMoreComments&&l.loadMoreComments(...n))},p(e.__("View previous comments")),1)],512),[[S,!s.loadingMore&&!s.loading&&s.showLoadMoreCommentsButton]]),!s.loading&&s.comments?(i(),a("div",q,[(i(!0),a(A,null,L(s.comments.data,n=>(i(),a("div",{key:n.id,class:"flex"},[t("div",E,[t("div",{class:x(["flex flex-col px-4 py-2 text-gray-700 bg-gray-100 rounded-tl-lg rounded-2xl dark:bg-cool-gray-600 dark:bg-opacity-25 dark:text-gray-200",{"border border-gray-300 dark:border-gray-700":e.$page.props.auth.user&&e.$page.props.auth.user.id===n.user_id}])},[d(g,{as:"div",class:"hover:cursor-pointer hover:underline",href:e.route("user.public.get",n.commentator.username)},{default:y(()=>[d(w,{user:n.commentator,"show-username":!0,"text-class":"font-sm"},{default:y(()=>[_((i(),a("span",{class:"inline ml-1 text-xs text-gray-500 dark:text-gray-400 focus:outline-none",title:u.formatToDayDateString(n.created_at)},[P(p(u.formatTimeAgoToNow(n.created_at)),1)],8,W)),[[C]])]),_:2},1032,["user"])]),_:2},1032,["href"]),t("span",{innerHTML:u.purifyAndLinkifyText(n.comment)},null,8,G)],2)]),t("img",{src:n.commentator.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,J),e.$page.props.auth.user&&n.permissions.delete?_((i(),b(g,{key:0,"preserve-scroll":!0,"preserve-state":!1,as:"button",method:"delete",href:e.route("post.comment.delete",[o.post.id,n.id]),class:"order-3 focus:outline-none"},{default:y(()=>[d(f,{name:"trash",class:"w-4 h-4 text-gray-200 hover:text-red-400 dark:text-gray-500 dark:hover:text-red-500"})]),_:2},1032,["href"])),[[k,{message:e.__("Are you sure you want to delete this comment?")}]]):c("",!0)]))),128))])):c("",!0),e.$page.props.auth.user?(i(),a("div",Q,[t("img",{src:e.$page.props.auth.user.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,R),t("div",X,[t("form",{onSubmit:r[3]||(r[3]=N((...n)=>l.submitComment&&l.submitComment(...n),["prevent"]))},[_(t("input",{ref:"comment","onUpdate:modelValue":r[1]||(r[1]=n=>s.commentBody=n),disabled:s.submitting,placeholder:e.__("Write a comment..."),"aria-label":"comment",type:"text",class:"block w-full mt-1 bg-gray-100 border border-gray-100 rounded-full dark:bg-cool-gray-900 focus:border-gray-300 dark:border-gray-800 dark:focus:border-gray-700 dark:text-gray-200 focus:ring-0 sm:text-sm disabled:opacity-50",onKeypress:r[2]||(r[2]=V((...n)=>l.submitComment&&l.submitComment(...n),["enter"]))},null,40,Y),[[j,s.commentBody]])],32),s.bodyerror?(i(),a("span",Z,p(s.bodyerror),1)):c("",!0)])])):c("",!0)])}const ee=D(H,[["render",$]]),te={components:{Comments:ee,Icon:T,UserDisplayname:B},props:{post:Object,commentsSectionOpened:{type:Boolean,default:!1}},setup(){const{purifyAndLinkifyText:e,formatTimeAgoToNow:r,formatToDayDateString:o}=M();return{purifyAndLinkifyText:e,formatTimeAgoToNow:r,formatToDayDateString:o}},data(){var e,r,o,u,s;return{liked:((r=(e=this.post.love_reactant)==null?void 0:e.reactions)==null?void 0:r.length)>0,likes_count:((s=(u=(o=this.post)==null?void 0:o.love_reactant)==null?void 0:u.reaction_total)==null?void 0:s.count)??0,showComments:this.commentsSectionOpened}},methods:{likePost(){if(!this.$page.props.auth.user){this.$inertia.get(route("login"));return}this.liked=!0,this.likes_count++,axios.post(route("reaction.post.like",this.post.id)).then(()=>{}).catch(()=>{this.liked=!1,this.likes_count--})},unlikePost(){if(!this.$page.props.auth.user){this.$inertia.get(route("login"));return}this.liked=!1,this.likes_count--,axios.post(route("reaction.post.unlike",this.post.id)).then(()=>{}).catch(()=>{this.liked=!0,this.likes_count++})}}},oe={class:"flex justify-between"},se={class:"flex"},re=["src"],ne={class:"ml-2 mt-0.5"},ie={class:"flex"},ae=["innerHTML"],le=["src"],ue={class:"flex items-center justify-end mt-5 space-x-10 text-gray-500"},de={class:"group-hover:bg-pink-100 dark:group-hover:bg-cool-gray-900 group-hover:text-pink-500 p-1.5 rounded-full transition duration-300 ease-in-out"},ce={class:"text-gray-500 dark:text-gray-400 font-light py-1.5 group-hover:text-pink-500 transition duration-300 ease-in-out"},me={class:"group-hover:bg-pink-100 dark:group-hover:bg-cool-gray-900 group-hover:text-pink-500 p-1.5 rounded-full transition duration-300 ease-in-out"},he={class:"text-pink-500 dark:text-gray-400 font-light py-1.5 group-hover:text-pink-500 transition duration-300 ease-in-out"},pe={class:"group-hover:bg-light-blue-100 dark:group-hover:bg-cool-gray-900 group-hover:text-light-blue-500 p-1.5 rounded-full transition duration-300 ease-in-out"},ge={class:"text-gray-500 dark:text-gray-400 font-light py-1.5 flex items-center group-hover:text-light-blue-500 transition duration-300 ease-in-out"};function fe(e,r,o,u,s,l){const w=h("user-displayname"),g=h("inertia-link"),f=h("icon"),C=h("comments"),k=v("tippy"),n=v("confirm");return i(),a("div",{class:x(["px-5 py-4 bg-white rounded shadow dark:bg-cool-gray-800",{"rounded-l-none border-l-4 border-light-blue-500":e.$page.props.auth.user&&e.$page.props.auth.user.id===o.post.user.id}])},[t("div",oe,[t("div",se,[t("img",{class:"w-12 h-12 rounded-full",src:o.post.user.profile_photo_url,alt:"profile photo"},null,8,re),t("div",ne,[d(g,{class:"cursor-pointer hover:underline dark:text-gray-300",as:"div",href:e.route("user.public.get",o.post.user.username)},{default:y(()=>[d(w,{user:o.post.user,"show-username":!0},null,8,["user"])]),_:1},8,["href"]),t("div",ie,[_((i(),b(g,{as:"a",href:e.route("post.show",o.post.id),content:u.formatToDayDateString(o.post.created_at),class:"text-sm font-light leading-snug text-gray-500 dark:hover:text-light-blue-500 focus:outline-none hover:text-light-blue-500 dark:text-gray-300"},{default:y(()=>[P(p(u.formatTimeAgoToNow(o.post.created_at)),1)]),_:1},8,["href","content"])),[[k]])])])]),e.$page.props.auth.user&&o.post.permissions.delete?_((i(),b(g,{key:0,title:e.__("Delete Post"),"preserve-scroll":!0,"preserve-state":!1,as:"button",method:"delete",href:e.route("post.delete",o.post.id),class:"flex items-start text-gray-500 rounded-full hover:text-red-500 focus:outline-none"},{default:y(()=>[d(f,{name:"trash",class:"h-6 w-6 p-0.5"})]),_:1},8,["title","href"])),[[n,{message:e.__("Are you sure you want to delete this Post?")}],[k]]):c("",!0)]),t("p",{class:"mt-2 leading-snug text-gray-800 break-words whitespace-pre-line dark:text-gray-200 md:leading-normal",innerHTML:u.purifyAndLinkifyText(o.post.body)},null,8,ae),o.post.media_url_array.length?(i(),a("div",{key:0,class:x(["grid gap-2",{"grid-cols-2":o.post.media_url_array.length>1}])},[(i(!0),a(A,null,L(o.post.media_url_array,m=>(i(),a("div",{key:m,class:"relative"},[t("img",{src:m,alt:"Attachment",class:x(["object-cover w-full h-full rounded-xl",o.post.media_url_array.length>1?"max-h-56":"max-h-96"])},null,10,le)]))),128))],2)):c("",!0),t("div",ue,[s.liked?(i(),a("button",{key:1,class:"flex text-pink-500 cursor-pointer group focus:outline-none",onClick:r[1]||(r[1]=(...m)=>l.unlikePost&&l.unlikePost(...m))},[t("span",me,[d(f,{name:"heart-fill",class:"w-6 h-6 p-0.5"})]),t("span",he,p(s.likes_count),1)])):(i(),a("button",{key:0,class:"flex cursor-pointer group focus:outline-none",onClick:r[0]||(r[0]=(...m)=>l.likePost&&l.likePost(...m))},[t("span",de,[d(f,{name:"heart-hollow",class:"h-6 w-6 p-0.5"})]),t("span",ce,p(s.likes_count),1)])),t("button",{class:"flex cursor-pointer group focus:outline-none",onClick:r[2]||(r[2]=m=>s.showComments=!s.showComments)},[t("span",pe,[d(f,{name:"comment",class:"h-6 w-6 p-0.5"})]),t("span",ge,p(o.post.comments_count),1)])]),s.showComments?(i(),b(C,{key:1,post:o.post},null,8,["post"])):c("",!0)],2)}const xe=D(te,[["render",fe]]);export{xe as P};
