import{I as v}from"./Icon-14807a0c.js";import{_ as w}from"./UserDisplayname-23fb9cca.js";import{u as C}from"./AppLayout-5fa2c638.js";import{s as h,z as g,o as r,d as a,e as i,m as d,x as M,a as s,t as c,F as T,g as B,n as D,b as f,w as y,f as L,c as N,l as V,v as A,a6 as S}from"./app-e2d1b450.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const H={components:{Icon:v,UserDisplayname:w},props:{commentable:Object,commentableType:String},setup(){const{purifyAndLinkifyText:e,formatTimeAgoToNow:n,formatToDayDateString:m}=C();return{purifyAndLinkifyText:e,formatTimeAgoToNow:n,formatToDayDateString:m}},data(){return{comments:null,loading:!0,loadingMore:!1,commentBody:"",submitting:!1,bodyerror:null,showLoadMoreCommentsButton:!0}},created(){axios.get(route(`${this.commentableType}.comment.index`,this.commentable.id)).then(e=>{this.comments=e.data,this.comments.data.reverse()}).finally(()=>{this.loading=!1})},methods:{loadMoreComments(){return this.comments.next_page_url?(this.loadingMore=!0,axios(this.comments.next_page_url).then(e=>{this.comments={...e.data,data:[...e.data.data.reverse(),...this.comments.data]}}).finally(()=>this.loadingMore=!1)):(this.showLoadMoreCommentsButton=!1,Promise.resolve())},submitComment(){this.submitting||(this.submitting=!0,this.bodyerror=null,axios.post(route(`${this.commentableType}.comment.store`,this.commentable.id),{comment:this.commentBody}).then(e=>{e.status===200&&(this.comments.data.push(e.data.data),this.commentBody="")}).catch(e=>{e.response.status===422?this.bodyerror=e.response.data.errors.comment[0]:this.bodyerror=e.response.data.message}).finally(()=>{this.submitting=!1,this.$nextTick(()=>{this.$refs.comment.focus()})}))}}},j={class:"flex flex-col"},F={key:0,class:"mt-0.5 dark:border-cool-gray-700"},I={key:1,class:"flex justify-center p-4"},K=s("svg",{class:"w-5 h-5 mr-3 -ml-1 animate-spin text-light-blue-600 dark:text-light-blue-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),U=[K],E={class:"flex mt-3"},O={key:2,class:"flex justify-center pt-4 text-gray-500 dark:text-gray-400 text-sm"},P={key:3,class:"flex flex-col mt-3 space-y-2"},W={class:"items-start order-2 max-w-lg mx-2 space-y-2 text-sm"},q=["title"],G=["innerHTML"],J=["src"],Q={key:4,class:"flex mt-1"},R=["src"],X={class:"flex-grow order-2 mx-2 text-sm"},Y=["disabled","placeholder"],Z={key:0,class:"ml-2 text-xs text-red-500"};function $(e,n,m,u,t,l){const _=h("user-displayname"),p=h("inertia-link"),b=h("icon"),x=g("tippy"),k=g("confirm");return r(),a("div",j,[m.commentableType=="post"?(r(),a("hr",F)):i("",!0),t.loading||t.loadingMore?(r(),a("div",I,U)):i("",!0),d(s("div",E,[s("button",{class:"text-sm font-semibold text-gray-500 dark:text-gray-400 focus:outline-none hover:underline",onClick:n[0]||(n[0]=(...o)=>l.loadMoreComments&&l.loadMoreComments(...o))},c(e.__("View previous comments")),1)],512),[[M,!t.loadingMore&&!t.loading&&t.showLoadMoreCommentsButton&&t.comments&&t.comments.next_page_url]]),!t.loading&&t.comments&&t.comments.data.length===0?(r(),a("div",O,c(e.__("No comments yet")),1)):i("",!0),!t.loading&&t.comments?(r(),a("div",P,[(r(!0),a(T,null,B(t.comments.data,o=>(r(),a("div",{key:o.id,class:"flex"},[s("div",W,[s("div",{class:D(["flex flex-col px-4 py-2 text-gray-700 bg-gray-100 rounded-tl-lg rounded-2xl dark:bg-cool-gray-600 dark:bg-opacity-25 dark:text-gray-200",{"border border-gray-300 dark:border-gray-700":e.$page.props.auth.user&&e.$page.props.auth.user.id===o.user_id}])},[f(p,{as:"a",class:"hover:cursor-pointer hover:underline",href:e.route("user.public.get",o.commentator.username)},{default:y(()=>[f(_,{user:o.commentator,"show-username":!0,"text-class":"font-sm"},{default:y(()=>[d((r(),a("span",{class:"inline ml-1 text-xs text-gray-500 dark:text-gray-400 focus:outline-none",title:u.formatToDayDateString(o.created_at)},[L(c(u.formatTimeAgoToNow(o.created_at)),1)],8,q)),[[x]])]),_:2},1032,["user"])]),_:2},1032,["href"]),s("span",{innerHTML:u.purifyAndLinkifyText(o.comment)},null,8,G)],2)]),s("img",{src:o.commentator.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,J),e.$page.props.auth.user&&o.permissions.delete?d((r(),N(p,{key:0,"preserve-scroll":!0,"preserve-state":!1,as:"button",method:"delete",href:e.route(`${m.commentableType}.comment.delete`,[m.commentable.id,o.id]),class:"order-3 focus:outline-none"},{default:y(()=>[f(b,{name:"trash",class:"w-4 h-4 text-gray-200 hover:text-red-400 dark:text-gray-500 dark:hover:text-red-500"})]),_:2},1032,["href"])),[[k,{message:e.__("Are you sure you want to delete this comment?")}]]):i("",!0)]))),128))])):i("",!0),e.$page.props.auth.user?(r(),a("div",Q,[s("img",{src:e.$page.props.auth.user.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,R),s("div",X,[s("form",{onSubmit:n[3]||(n[3]=V((...o)=>l.submitComment&&l.submitComment(...o),["prevent"]))},[d(s("input",{ref:"comment","onUpdate:modelValue":n[1]||(n[1]=o=>t.commentBody=o),disabled:t.submitting,placeholder:e.__("Write a comment..."),"aria-label":"comment",type:"text",class:"block w-full mt-1 bg-gray-100 border border-gray-100 rounded-full dark:bg-cool-gray-900 focus:border-gray-300 dark:border-gray-800 dark:focus:border-gray-700 dark:text-gray-200 focus:ring-0 sm:text-sm disabled:opacity-50",onKeypress:n[2]||(n[2]=S((...o)=>l.submitComment&&l.submitComment(...o),["enter"]))},null,40,Y),[[A,t.commentBody]])],32),t.bodyerror?(r(),a("span",Z,c(t.bodyerror),1)):i("",!0)])])):i("",!0)])}const ne=z(H,[["render",$]]);export{ne as C};
