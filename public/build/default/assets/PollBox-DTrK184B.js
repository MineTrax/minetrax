import{u as y}from"./AppLayout-D09sHPWy.js";import{o as l,d as n,a as i,F as f,g,n as u,m,t as r,e as c,y as _,s as x,b,aF as k}from"./app-B6MSbjiR.js";import{_ as v}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={name:"Poll",props:{question:{type:String,required:!1},answers:{type:Array,required:!1},showResults:{type:Boolean,default:!1},showTotalVotes:{type:Boolean,default:!0},finalResults:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},submitButtonText:{type:String,default:"Submit"},customId:{type:Number,default:0},isComingSoon:{type:Boolean,default:!1},started_at:{type:String,default:null},closed_at:{type:String,default:null}},setup(){const{formatTimeAgoToNow:e,formatToDayDateString:s}=y();return{formatTimeAgoToNow:e,formatToDayDateString:s}},data(){return{visibleResults:JSON.parse(this.showResults)}},computed:{totalVotes(){let e=0;return this.answers.filter(s=>{!isNaN(s.votes)&&s.votes>0&&(e+=parseInt(s.votes))}),e},totalVotesFormatted(){return this.totalVotes.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},mostVotes(){let e=0;return this.answers.filter(s=>{!isNaN(s.votes)&&s.votes>0&&s.votes>=e&&(e=s.votes)}),e},calcAnswers(){return this.totalVotes===0?this.answers.map(e=>(e.percent="0%",e)):this.answers.filter(e=>(!isNaN(e.votes)&&e.votes>0?e.percent=Math.round(parseInt(e.votes)/this.totalVotes*100)+"%":e.percent="0%",e))},totalSelections(){return this.calcAnswers.filter(e=>e.selected).length}},methods:{handleMultiple(){let e=[];this.calcAnswers.filter(t=>{t.selected&&(t.votes++,e.push({value:t.value,votes:t.votes}))}),this.visibleResults=!0;let s={arSelected:e,totalVotes:this.totalVotes};this.customId&&(s.customId=this.customId),this.$emit("addvote",s)},handleVote(e){if(this.isComingSoon)return;if(this.multiple){e.selected===void 0&&console.log("Please add 'selected: false' on the answer object"),e.selected=!e.selected;return}this.$page.props.auth.user&&(e.votes++,e.selected=!0,this.visibleResults=!0);let s={value:e.value,votes:e.votes,totalVotes:this.totalVotes};this.customId&&(s.customId=this.customId),this.$emit("addvote",s)}}},V={class:"vue-poll"},S=["innerHTML"],C={class:"ans-cnt"},T=["onClick"],N=["innerHTML"],R=["textContent"],B=["innerHTML"],L=["textContent"],M=["innerHTML"],A={key:0,class:"text-secondary-400 text-xs italic"},P={class:"flex justify-between items-baseline"},H=["textContent"],I={key:1,class:"text-secondary-400 text-xs italic"},j=["textContent"];function q(e,s,t,h,d,a){return l(),n("div",V,[i("h3",{class:"qst dark:text-secondary-300",innerHTML:t.question},null,8,S),i("div",C,[(l(!0),n(f,null,g(a.calcAnswers,(o,p)=>(l(),n("div",{key:p,class:u({ans:!0,[o.custom_class]:o.custom_class})},[t.finalResults?(l(),n(f,{key:1},[i("div",{class:u({"ans-voted final dark:text-secondary-200":!0,selected:o.selected})},[o.percent?(l(),n("span",{key:0,class:"percent",textContent:r(o.percent)},null,8,L)):c("",!0),i("span",{class:"txt",innerHTML:o.text},null,8,M)],2),i("span",{class:u({"bg bg-surface-200 dark:bg-surface-700":!0,"bg-primary-300 dark:bg-primary-500":a.mostVotes==o.votes}),style:_({width:o.percent})},null,6)],64)):(l(),n(f,{key:0},[d.visibleResults?(l(),n("div",{key:1,class:u({"ans-voted dark:text-secondary-200":!0,selected:o.selected})},[o.percent?(l(),n("span",{key:0,class:"percent",textContent:r(o.percent)},null,8,R)):c("",!0),i("span",{class:"txt",innerHTML:o.text},null,8,B)],2)):(l(),n("div",{key:0,class:u(["hover:bg-primary-100 dark:hover:bg-surface-900",{"ans-no-vote noselect":!0,active:o.selected}]),onClick:m(Q=>a.handleVote(o),["prevent"])},[i("span",{class:"txt",innerHTML:o.text},null,8,N)],10,T)),i("span",{class:"bg bg-surface-200 dark:bg-surface-700",style:_({width:d.visibleResults?o.percent:"0%"})},null,4)],64))],2))),128))]),t.isComingSoon?(l(),n("div",A,r(e.__("Poll starting"))+" "+r(h.formatTimeAgoToNow(t.started_at)),1)):c("",!0),i("div",P,[t.showTotalVotes&&(d.visibleResults||t.finalResults)?(l(),n("div",{key:0,class:"votes",textContent:r(a.totalVotesFormatted+" votes")},null,8,H)):c("",!0),!t.isComingSoon&&t.closed_at&&!t.finalResults?(l(),n("div",I,r(e.__("Poll closing"))+" "+r(h.formatTimeAgoToNow(t.closed_at)),1)):c("",!0)]),!t.finalResults&&!d.visibleResults&&t.multiple&&a.totalSelections>0?(l(),n("a",{key:1,href:"#",class:"submit",onClick:s[0]||(s[0]=m((...o)=>a.handleMultiple&&a.handleMultiple(...o),["prevent"])),textContent:r(t.submitButtonText)},null,8,j)):c("",!0)])}const F=v(w,[["render",q]]),D={components:{Poll:F},props:{poll:Object,isListing:{type:Boolean,default:!1}},data(){return{options:this.poll}},methods:{addVote(e){this.poll.isComingSoon||this.$inertia.post(route("poll.vote",[this.poll.id,e.value]),null,{preserveState:!0,preserveScroll:!0})}}},z={key:0},O={class:"p-3 sm:px-5 bg-white dark:bg-surface-800 rounded shadow"},E={key:0,class:"font-extrabold text-secondary-800 dark:text-secondary-200"},J={key:1,class:"font-extrabold text-secondary-800 dark:text-secondary-200"},G={class:"mt-3 text-secondary-500 dark:text-secondary-300"};function K(e,s,t,h,d,a){const o=x("poll");return t.poll?(l(),n("div",z,[i("div",O,[t.isListing?c("",!0):(l(),n("h3",E,r(e.__("Latest Poll")),1)),t.isListing?(l(),n("h3",J,r(e.__("Poll"))+" "+r(t.poll.id),1)):c("",!0),i("div",G,[b(o,k(d.options,{onAddvote:a.addVote}),null,16,["onAddvote"])])])])):c("",!0)}const Y=v(D,[["render",K]]);export{Y as P};
