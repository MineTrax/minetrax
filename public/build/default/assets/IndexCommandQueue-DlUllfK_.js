import{_ as S}from"./AdminLayout-CjagHNcW.js";import{u as B}from"./useAuthorizable-B2TCKEv8.js";import{u as N}from"./BaseLayout-DfXV1WNK.js";import{h as D,y as P,z as A,c as x,w as i,s as V,o,b as d,j as e,a,v as c,P as g,i as u,t,g as v,d as r,B as $}from"./app-Bh5uq5T2.js";import{_ as O}from"./DataTable-BaXbvkK6.js";import{D as _}from"./DtRowItem-C0VH15na.js";import{_ as Q}from"./AppBreadcrumb-CEuU89zV.js";import{_ as q}from"./index-Bvduyk2Y.js";import{_ as T}from"./CommonStatusBadge-DruEQOGM.js";import{_ as U,a as F,b as L,c as z,d as H}from"./DialogTitle-CYXK67HI.js";import{_ as M}from"./UserDisplayname-B5X7YDQ-.js";import{r as G}from"./EyeIcon-G0h5gXDH.js";import{r as J}from"./ArrowPathIcon-CxWI3Cuk.js";import{r as K}from"./TrashIcon-DKFwl6gR.js";import"./CloudArrowDownIcon-peUI9MxF.js";import"./index-BlQc97mu.js";import"./utils-D-KgF5mV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Icon-B54a8he6.js";import"./useForwardPropsEmits-CoSvaN6q.js";import"./chevron-down-BM8GSVcu.js";import"./Teleport-C8LT0wZ6.js";import"./VisuallyHidden-C0pHwiql.js";import"./x-Dxr5v1SF.js";import"./SelectValue-B7I_M8gp.js";import"./useFormControl-pZlKIA-M.js";import"./vue-multiselect.esm-lFmy1_TG.js";import"./XMarkIcon-CHsIiBI1.js";const W={class:"px-10 py-8 mx-auto text-foreground"},X={class:"flex justify-between mb-4"},Y={class:"flex"},Z={class:"px-4 py-4 text-sm font-medium text-foreground whitespace-nowrap dark:text-foreground"},ee=["title"],te={key:1,class:"text-foreground italic"},se={class:"text-xs dark:text-foreground"},ae=["title"],oe={key:1,class:"text-foreground italic"},le={key:0,class:"text-foreground dark:text-foreground"},ne={key:1,class:"text-error-500 italic"},re={key:1,class:"italic text-foreground"},de=["title"],ie={key:1,class:"italic"},ce=["title"],ue={class:"px-6 py-4 space-x-2 text-sm font-medium text-right whitespace-nowrap"},me=["onClick","title"],_e={class:"w-full text-sm grid grid-cols-2 gap-4 py-4"},pe={class:"col-span-2"},fe={class:"font-semibold text-foreground mb-1"},xe={class:"block bg-muted px-3 py-2 rounded text-sm font-mono break-all"},he={class:"col-span-2"},ye={class:"font-semibold text-foreground mb-1"},be={key:0,class:"block bg-muted px-3 py-2 rounded text-sm font-mono break-all"},ge={key:1,class:"italic text-muted-foreground"},ke={class:"font-semibold text-foreground mb-1"},ve={class:"font-semibold text-foreground mb-1"},we={key:0},Ce={key:1,class:"italic text-muted-foreground"},De={class:"font-semibold text-foreground mb-1"},Ae={class:"font-semibold text-foreground mb-1"},$e={class:"font-semibold text-foreground mb-1"},qe={class:"flex items-center gap-2"},Te=["title"],je={key:1,class:"text-muted-foreground italic"},Ee={class:"text-sm text-muted-foreground"},Ie={class:"font-semibold text-foreground mb-1"},Re=["title"],Se={key:1,class:"text-muted-foreground italic"},Be={class:"font-semibold text-foreground mb-1"},Ne={key:0,class:"flex items-center gap-2"},Pe=["src"],Ve={key:0,class:"font-semibold"},Oe={key:1,class:"italic text-destructive"},Qe={key:1,class:"italic text-muted-foreground"},Ue={class:"font-semibold text-foreground mb-1"},Fe={key:0},Le={key:1,class:"italic text-muted-foreground"},ze={class:"font-semibold text-foreground mb-1"},He={class:"font-semibold text-foreground mb-1"},Me=["title"],Ge={class:"col-span-2"},Je={class:"font-semibold text-foreground mb-1"},Ke={key:0,class:"block bg-muted px-3 py-2 rounded text-sm font-mono break-all"},We={key:1,class:"italic text-muted-foreground"},At={__name:"IndexCommandQueue",props:{commandQueues:Object,filters:Object},setup(w){const{can:k}=B(),{__:s}=V(),{formatTimeAgoToNow:h,formatToDayDateString:y}=N(),j=[{text:s("Admin"),current:!1},{text:s("Commands"),url:route("admin.command-queue.index"),current:!0}],E=[{key:"id",label:s("ID"),sortable:!0},{key:"parsed_command",label:s("Command"),sortable:!0,filterable:{type:"text"}},{key:"server_id",sortable:!0,label:s("Server"),filterable:{key:"server.name",type:"text"}},{key:"status",label:s("Status"),sortable:!0,filterable:{type:"multiselect",options:["pending","running","failed","cancelled","deferred","completed"]}},{key:"last_attempt_at",sortable:!0,label:s("Last Attempted"),class:"whitespace-nowrap"},{key:"execute_at",sortable:!0,label:s("Execute At"),class:"whitespace-nowrap"},{key:"tag",sortable:!0,label:s("Tags"),filterable:{type:"text"}},{key:"player_id",sortable:!0,label:s("For Player"),class:"whitespace-nowrap",filterable:{key:"player.username",type:"text"}},{key:"output",label:s("Output"),sortable:!0,filterable:{type:"text"}},{key:"created_at",sortable:!0,label:s("Created"),class:"whitespace-nowrap"},{key:"actions",label:s("Actions"),sortable:!1,class:"w-1/12 text-right"}];let p=D(!1),n=D({});const I=f=>{n.value=f,p.value=!0};return(f,b)=>{const R=P("app-head"),C=A("confirm"),m=A("tippy");return o(),x(S,null,{default:i(()=>[d(R,{title:e(s)("Command History")},null,8,["title"]),a("div",W,[a("div",X,[d(Q,{class:"mt-0","breadcrumb-class":"max-w-none px-0 md:px-0",items:j}),a("div",Y,[e(k)("create command_queues")?(o(),x(e(q),{key:0,"as-child":""},{default:i(()=>[c((o(),x(e(g),{href:f.route("admin.command-queue.retry"),method:"post",as:"button"},{default:i(()=>[u(t(e(s)("Retry All Failed")),1)]),_:1},8,["href"])),[[C,{message:"Are you sure you wanna retry all failed & cancelled command queues? Please note that failed commands automatically get retried till they reach the max attempts."}]])]),_:1})):v("",!0)])]),d(O,{class:"bg-card rounded-lg shadow",header:E,data:w.commandQueues,filters:w.filters},{default:i(({item:l})=>[a("td",Z,t(l.id),1),d(_,{class:"text-left font-mono"},{default:i(()=>[u(t(l.parsed_command),1)]),_:2},1024),d(_,{class:"text-left whitespace-nowrap"},{default:i(()=>[u(t(l.server.name),1)]),_:2},1024),d(_,{class:"text-left"},{default:i(()=>[d(T,{status:l.status.value},null,8,["status"])]),_:2},1024),d(_,null,{default:i(()=>[l.last_attempt_at?c((o(),r("div",{key:0,class:"whitespace-nowrap",title:e(y)(l.last_attempt_at)},[u(t(e(h)(l.last_attempt_at)),1)],8,ee)),[[m]]):(o(),r("div",te,t("not yet"))),a("div",se,t(e(s)("Attempts: :attempts/:max_attempts",{attempts:l.attempts,max_attempts:l.max_attempts??1})),1)]),_:2},1024),d(_,null,{default:i(()=>[l.execute_at?c((o(),r("div",{key:0,class:"text-sm font-medium text-foreground dark:text-foreground whitespace-nowrap",title:e(y)(l.execute_at)},[u(t(e(h)(l.execute_at)),1)],8,ae)),[[m]]):(o(),r("div",oe,t("no delay")))]),_:2},1024),d(_,{class:"text-left"},{default:i(()=>[u(t(l.tag??e(s)("none")),1)]),_:2},1024),d(_,{class:"text-center"},{default:i(()=>[l.player_id?c((o(),x(e(g),{key:0,as:"a",href:f.route("player.show",l.player.uuid),class:"text-sm font-medium text-foreground dark:text-foreground focus:outline-none cursor-pointer hover:underline",content:l.player.uuid},{default:i(()=>[l.player.username?(o(),r("span",le,t(l.player.username),1)):(o(),r("span",ne,t(e(s)("Unknown")),1))]),_:2},1032,["href","content"])),[[m]]):(o(),r("div",re,t(e(s)("none")),1))]),_:2},1024),d(_,{class:"text-left"},{default:i(()=>[l.output?(o(),r("span",{key:0,class:"truncate",title:l.output},t(l.output.length>10?l.output.substring(0,10)+"...":l.output),9,de)):(o(),r("span",ie,t(e(s)("none")),1))]),_:2},1024),d(_,null,{default:i(()=>[c((o(),r("div",{class:"text-sm font-medium text-foreground dark:text-foreground whitespace-nowrap",title:e(y)(l.created_at)},[u(t(e(h)(l.created_at)),1)],8,ce)),[[m]])]),_:2},1024),a("td",ue,[c((o(),r("button",{onClick:Xe=>I(l),class:"inline-flex items-center justify-center text-primary hover:text-primary",title:e(s)("View Details")},[d(e(G),{class:"inline-block w-5 h-5"})],8,me)),[[m]]),e(k)("create command_queues")&&["failed","cancelled"].includes(l.status.value)?c((o(),x(e(g),{key:0,as:"button",method:"post",data:{id:l.id},href:f.route("admin.command-queue.retry"),class:"inline-flex items-center justify-center text-success-600 dark:text-success-500 hover:text-success-800 dark:hover:text-success-800",title:e(s)("Retry Command")},{default:i(()=>[d(e(J),{class:"inline-block w-5 h-5"})]),_:2},1032,["data","href","title"])),[[m]]):v("",!0),e(k)("delete command_queues")&&["pending","failed","cancelled","completed","deferred"].includes(l.status.value)?c((o(),x(e(g),{key:1,as:"button",method:"DELETE",data:{id:l.id},href:f.route("admin.command-queue.delete"),class:"inline-flex items-center justify-center text-error-600 hover:text-error-900 focus:outline-none",title:e(s)("Delete Command")},{default:i(()=>[d(e(K),{class:"inline-block w-5 h-5"})]),_:2},1032,["data","href","title"])),[[C,{message:"Are you sure you want to delete this command history?"}],[m]]):v("",!0)])]),_:1},8,["data","filters"])]),d(e(H),{open:e(p),"onUpdate:open":b[1]||(b[1]=l=>$(p)?p.value=l:p=l)},{default:i(()=>[d(e(U),{class:"sm:max-w-2xl max-h-[90vh] overflow-y-auto"},{default:i(()=>[d(e(F),null,{default:i(()=>[d(e(L),null,{default:i(()=>[u(t(e(s)("Run Details")),1)]),_:1})]),_:1}),a("div",_e,[a("div",pe,[a("p",fe,t(e(s)("Command")),1),a("code",xe,t(e(n).parsed_command),1)]),a("div",he,[a("p",ye,t(e(s)("Output")),1),e(n).output?(o(),r("code",be,t(e(n).output),1)):(o(),r("div",ge,t(e(s)("none")),1))]),a("div",null,[a("p",ke,t(e(s)("ID")),1),a("p",null,t(e(n).id),1)]),a("div",null,[a("p",ve,t(e(s)("Command ID")),1),e(n).command_id?(o(),r("p",we,t(e(n).command_id),1)):(o(),r("p",Ce,t(e(s)("none")),1))]),a("div",null,[a("p",De,t(e(s)("Server")),1),a("p",null,t(e(n).server.name),1)]),a("div",null,[a("p",Ae,t(e(s)("Status")),1),d(T,{status:e(n).status.value},null,8,["status"])]),a("div",null,[a("p",$e,t(e(s)("Last Attempted")),1),a("div",qe,[e(n).last_attempt_at?c((o(),r("span",{key:0,class:"whitespace-nowrap",title:e(y)(e(n).last_attempt_at)},[u(t(e(h)(e(n).last_attempt_at)),1)],8,Te)),[[m]]):(o(),r("span",je,t("not yet"))),b[2]||(b[2]=a("span",{class:"text-muted-foreground"},"â€¢",-1)),a("span",Ee,t(e(s)("Attempts: :attempts/:max_attempts",{attempts:e(n).attempts,max_attempts:e(n).max_attempts??1})),1)])]),a("div",null,[a("p",Ie,t(e(s)("Execute At")),1),a("div",null,[e(n).execute_at?c((o(),r("span",{key:0,class:"text-sm font-medium whitespace-nowrap",title:e(y)(e(n).execute_at)},[u(t(e(h)(e(n).execute_at)),1)],8,Re)),[[m]]):(o(),r("span",Se,t("no delay")))])]),a("div",null,[a("p",Be,t(e(s)("For Player")),1),e(n).player_id?(o(),r("div",Ne,[a("img",{class:"w-8 h-8 rounded",src:e(n).player.avatar_url,alt:""},null,8,Pe),c((o(),x(e(g),{as:"a",href:f.route("player.show",e(n).player.uuid),class:"font-medium hover:underline",content:e(n).player.uuid},{default:i(()=>[e(n).player.username?(o(),r("span",Ve,t(e(n).player.username),1)):(o(),r("span",Oe,t(e(s)("Unknown")),1))]),_:1},8,["href","content"])),[[m]])])):(o(),r("div",Qe,t(e(s)("none")),1))]),a("div",null,[a("p",Ue,t(e(s)("User")),1),e(n).user_id?(o(),r("div",Fe,[d(e(g),{href:f.route("user.public.get",e(n).user.username)},{default:i(()=>[d(M,{user:e(n).user,"icon-class":"w-4 h-4","text-class":"text-sm"},null,8,["user"])]),_:1},8,["href"])])):(o(),r("div",Le,t(e(s)("none")),1))]),a("div",null,[a("p",ze,t(e(s)("Tags")),1),a("p",null,t(e(n).tag??e(s)("none")),1)]),a("div",null,[a("p",He,t(e(s)("Created At")),1),c((o(),r("span",{class:"text-sm font-medium whitespace-nowrap",title:e(y)(e(n).created_at)},[u(t(e(h)(e(n).created_at)),1)],8,Me)),[[m]])]),a("div",Ge,[a("p",Je,t(e(s)("Config")),1),e(n).config?(o(),r("code",Ke,t(e(n).config),1)):(o(),r("div",We,t(e(s)("none")),1))])]),d(e(z),null,{default:i(()=>[d(e(q),{variant:"outline",onClick:b[0]||(b[0]=l=>$(p)?p.value=!1:p=!1)},{default:i(()=>[u(t(e(s)("Close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})}}};export{At as default};
