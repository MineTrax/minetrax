import{r as f,k as q,i as E,H as M,c as h,w as a,o as t,f as l,t as o,d as s,a as n,e as i,b as c,u as C,a7 as N,F as Q,g as W,n as b,T as Y,W as A}from"./app-Dln4v3uo.js";import{_ as D}from"./ActionSection-Cu0Sq1H_.js";import{_ as R}from"./Button-Cd5Andyi.js";import{_ as v}from"./ConfirmsPassword-qYO3-HHc.js";import{_ as P}from"./DangerButton-hI2J3Uh2.js";import{_ as T}from"./SecondaryButton-DxxEIpk2.js";import{X}from"./XInput-7ATZzzop.js";import"./SectionTitle-40kNxt4S.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogModal-IcCx-O-H.js";import"./Modal-STwimov2.js";import"./Input-DkOzMFAH.js";import"./InputError-hOCs4iai.js";const z={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-300"},G={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-400"},I={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-300"},O={class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},U={key:3},j={key:0},J={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},Z={key:0,class:"font-semibold"},ee={key:1},te=["innerHTML"],oe={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ae={class:"font-semibold"},se=["innerHTML"],re={key:1,class:"mt-4"},ne={key:1},ie={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},le={class:"font-semibold"},ce={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-900 dark:text-gray-300 rounded-lg"},ue={class:"mt-5"},de={key:0},me={key:1},Fe={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(V){const B=V,u=f(!1),r=f(!1),d=f(!1),g=f(null),w=f(null),p=f([]),m=q({code:""}),_=E(()=>{var e,y;return!u.value&&((y=(e=Y().props.auth)==null?void 0:e.user)==null?void 0:y.two_factor_enabled)});M(_,()=>{_.value||(m.reset(),m.clearErrors())});const K=()=>{u.value=!0,A.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([H(),L(),x()]),onFinish:()=>{u.value=!1,r.value=B.requiresConfirmation}})},H=()=>axios.get("/user/two-factor-qr-code").then(e=>{g.value=e.data.svg}),L=()=>axios.get("/user/two-factor-secret-key").then(e=>{w.value=e.data.secretKey}),x=()=>axios.get("/user/two-factor-recovery-codes").then(e=>{p.value=e.data}),F=()=>{m.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{r.value=!1,g.value=null,w.value=null}})},$=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>x())},S=()=>{d.value=!0,A.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess:()=>{d.value=!1,r.value=!1}})};return(e,y)=>(t(),h(D,null,{title:a(()=>[l(o(e.__("Two Factor Authentication")),1)]),description:a(()=>[l(o(e.__("Add additional security to your account using two factor authentication.")),1)]),content:a(()=>[_.value&&!r.value?(t(),s("h3",z,o(e.__("You have enabled two factor authentication.")),1)):_.value&&r.value?(t(),s("h3",G,o(e.__("Finish enabling two factor authentication.")),1)):(t(),s("h3",I,o(e.__("You have not enabled two factor authentication.")),1)),n("div",O,[n("p",null,o(e.__("When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application.")),1)]),_.value?(t(),s("div",U,[g.value?(t(),s("div",j,[n("div",J,[r.value?(t(),s("p",Z,o(e.__("To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code.")),1)):(t(),s("p",ee,o(e.__("Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key.")),1))]),n("div",{class:"mt-4 dark:bg-white dark:p-4 dark:rounded",innerHTML:g.value},null,8,te),w.value?(t(),s("div",oe,[n("p",ae,[l(o(e.__("Setup Key"))+": ",1),n("span",{innerHTML:w.value},null,8,se)])])):i("",!0),r.value?(t(),s("div",re,[c(X,{id:"code",modelValue:C(m).code,"onUpdate:modelValue":y[0]||(y[0]=k=>C(m).code=k),inputmode:"numeric",label:e.__("Code"),error:C(m).errors.code,autocomplete:"one-time-code",autofocus:"",class:"block mt-1 w-1/2",type:"text",name:"code",onKeyup:N(F,["enter"])},null,8,["modelValue","label","error"])])):i("",!0)])):i("",!0),p.value.length>0&&!r.value?(t(),s("div",ne,[n("div",ie,[n("p",le,o(e.__("Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost.")),1)]),n("div",ce,[(t(!0),s(Q,null,W(p.value,k=>(t(),s("div",{key:k},o(k),1))),128))])])):i("",!0)])):i("",!0),n("div",ue,[_.value?(t(),s("div",me,[c(v,{onConfirmed:F},{default:a(()=>[r.value?(t(),h(R,{key:0,type:"button",class:b(["mr-3",{"opacity-25":u.value}]),disabled:u.value},{default:a(()=>[l(o(e.__("Confirm")),1)]),_:1},8,["class","disabled"])):i("",!0)]),_:1}),c(v,{onConfirmed:$},{default:a(()=>[p.value.length>0&&!r.value?(t(),h(T,{key:0,class:"mr-3"},{default:a(()=>[l(o(e.__("Regenerate Recovery Codes")),1)]),_:1})):i("",!0)]),_:1}),c(v,{onConfirmed:x},{default:a(()=>[p.value.length===0&&!r.value?(t(),h(T,{key:0,class:"mr-3"},{default:a(()=>[l(o(e.__("Show Recovery Codes")),1)]),_:1})):i("",!0)]),_:1}),c(v,{onConfirmed:S},{default:a(()=>[r.value?(t(),h(T,{key:0,class:b({"opacity-25":d.value}),disabled:d.value},{default:a(()=>[l(o(e.__("Cancel")),1)]),_:1},8,["class","disabled"])):i("",!0)]),_:1}),c(v,{onConfirmed:S},{default:a(()=>[r.value?i("",!0):(t(),h(P,{key:0,class:b({"opacity-25":d.value}),disabled:d.value},{default:a(()=>[l(o(e.__("Disable")),1)]),_:1},8,["class","disabled"]))]),_:1})])):(t(),s("div",de,[c(v,{onConfirmed:K},{default:a(()=>[c(R,{type:"button",class:b({"opacity-25":u.value}),disabled:u.value},{default:a(()=>[l(o(e.__("Enable")),1)]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Fe as default};
