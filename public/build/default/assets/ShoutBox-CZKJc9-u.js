import{I as V}from"./Icon-yp24RCPW.js";import{u as B}from"./BaseLayout-CbEnUUda.js";import{_ as E}from"./Input-ByO3GjMj.js";import{h as F,ci as w,y as p,z as k,o as r,c as g,w as d,b as o,a as s,t as l,d as n,g as c,l as j,G as S,i as u,v as x,F as C,a1 as K}from"./app-CKqa03ai.js";import{q as Q}from"./index-C1xLcZ71.js";import{_ as A}from"./Card-JiHMqSLw.js";import{_ as $}from"./CardContent-BTTmHOnn.js";import{_ as z}from"./Skeleton-DolNR_Tv.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={components:{Icon:V,Card:A,CardContent:$,Input:E,Skeleton:z},setup(){const{formatTimeAgoToNow:e,formatToDayDateString:h}=B(),m=F(null),_=Q(m);return{formatTimeAgoToNow:e,formatToDayDateString:h,box:m,isVisible:_}},data(){return{shouts:[],message:"",error:null,loading:!0,sending:!1,shoutQueryInterval:null}},created(){this.$page.props.generalSettings.enable_shoutbox&&(axios.get(route("shout.index")).then(e=>{this.shouts=e.data}).finally(()=>{this.loading=!1}),w?Echo.channel("shouts").listen("ShoutCreated",e=>{this.shouts.unshift(e.data)}):this.shoutQueryInterval=setInterval(()=>{this.isVisible&&this.pollServerForNewShouts()},5e3))},unmounted(){this.shoutQueryInterval&&clearInterval(this.shoutQueryInterval)},methods:{sendShout(){this.sending=!0,this.error=null,axios.post(route("shout.store"),{message:this.message}).then(e=>{e.status===200&&this.shouts.unshift(e.data)}).catch(e=>{e.response.status===422?this.error=e.response.data.errors.message[0]:e.response.status===403?this.error=e.response.data.message:this.error=this.__("Something went wrong. Try again.")}).finally(()=>{this.message="",this.sending=!1,this.$nextTick(()=>{this.$refs.inputbox.$el.focus()})})},pollServerForNewShouts(){if(w)return;const e=this.shouts.length>0?this.shouts[0].id:0;axios.get(route("shout.index",{after:e})).then(h=>{const m=h.data;m.length>0&&(this.shouts=[...m,...this.shouts])})}}},R={class:"font-extrabold text-card-foreground"},U={class:"overflow-auto flex-col space-y-4 max-h-96 hide-scrollbar"},q={key:0,class:"space-y-4"},G={class:"chat-message"},H={class:"flex"},O={class:"order-2 items-start mx-2 space-y-2 max-w-xs text-sm"},W={class:"flex flex-col px-4 py-2 rounded-2xl rounded-tl-lg bg-muted"},J={class:"mb-2"},P={class:"space-y-1"},X={class:"chat-message"},Y={class:"flex justify-end"},Z={class:"order-1 items-start mx-2 space-y-2 max-w-xs text-sm"},ee={class:"flex flex-col px-4 py-2 rounded-2xl rounded-tr-lg bg-primary"},se={class:"mb-2 text-right"},te={class:"space-y-1"},oe={class:"chat-message"},re={class:"flex"},ae={class:"order-2 items-start mx-2 space-y-2 max-w-xs text-sm"},le={class:"flex flex-col px-4 py-2 rounded-2xl rounded-tl-lg bg-muted"},ne={class:"mb-2"},ie={class:"space-y-1"},de={key:0,class:"flex"},ce={class:"order-2 items-start mx-2 space-y-2 max-w-xs text-sm"},ue={class:"flex flex-col px-4 py-2 rounded-2xl rounded-tl-lg text-card-foreground bg-muted"},he=["title"],me={class:"text-justify"},_e=["src"],fe={key:1,class:"flex justify-end"},pe={class:"order-1 items-start mx-2 space-y-2 max-w-xs text-sm"},ge={class:"flex flex-col px-4 py-2 rounded-2xl rounded-tr-lg text-primary-foreground bg-primary"},xe={class:"text-right"},ye=["title"],ve={class:"text-justify"},be=["src"],we={key:1,class:"italic text-center text-muted-foreground"},ke={key:0},Se={key:1,class:"text-xs text-destructive"},Ce={key:1,class:"text-sm text-center text-card-foreground"};function Te(e,h,m,_,i,T){const a=p("Skeleton"),f=p("inertia-link"),y=p("icon"),I=p("Input"),D=p("CardContent"),N=p("Card"),v=k("tippy"),b=k("confirm");return e.$page.props.generalSettings.enable_shoutbox?(r(),g(N,{key:0,ref:"box"},{default:d(()=>[o(D,{class:"p-3 space-y-4"},{default:d(()=>[s("h3",R,l(e.__("Shout Box")),1),s("div",U,[i.loading?(r(),n("div",q,[s("div",G,[s("div",H,[s("div",O,[s("div",W,[s("div",J,[o(a,{class:"inline-block w-16 h-4"}),o(a,{class:"inline-block ml-1 w-12 h-3"})]),s("div",P,[o(a,{class:"w-32 h-4"}),o(a,{class:"w-24 h-4"})])])]),o(a,{class:"order-1 mt-2 w-8 h-8 rounded-full"})])]),s("div",X,[s("div",Y,[s("div",Z,[s("div",ee,[s("div",se,[o(a,{class:"inline-block mr-1 w-12 h-3"}),o(a,{class:"inline-block w-16 h-4"})]),s("div",te,[o(a,{class:"w-28 h-4"}),o(a,{class:"w-20 h-4"})])])]),o(a,{class:"order-2 mt-2 w-8 h-8 rounded-full"})])]),s("div",oe,[s("div",re,[s("div",ae,[s("div",le,[s("div",ne,[o(a,{class:"inline-block w-20 h-4"}),o(a,{class:"inline-block ml-1 w-10 h-3"})]),s("div",ie,[o(a,{class:"w-36 h-4"})])])]),o(a,{class:"order-1 mt-2 w-8 h-8 rounded-full"})])])])):c("",!0),(r(!0),n(C,null,j(i.shouts,t=>(r(),n("div",{key:t.id,class:"chat-message"},[!e.$page.props.auth.user||t.user_id!==e.$page.props.auth.user.id?(r(),n("div",de,[s("div",ce,[s("div",ue,[s("div",null,[o(f,{as:"span",href:e.route("user.public.get",t.user.username),class:"font-semibold cursor-pointer hover:underline",style:S([t.user.roles[0].color?{color:t.user.roles[0].color}:null])},{default:d(()=>[u(l(t.user.username),1)]),_:2},1032,["href","style"]),x((r(),n("span",{class:"ml-1 text-xs text-muted-foreground focus:outline-none",title:_.formatToDayDateString(t.created_at)},[u(l(_.formatTimeAgoToNow(t.created_at,!1)),1)],8,he)),[[v]])]),s("span",me,l(t.message),1)])]),s("img",{src:t.user.profile_photo_url,alt:"My profile",class:"order-1 mt-2 w-8 h-8 rounded-full"},null,8,_e),e.$page.props.auth.user&&t.permissions.delete?x((r(),g(f,{key:0,class:"order-3 focus:outline-none","preserve-state":!1,as:"button",method:"delete",href:e.route("shout.delete",t.id)},{default:d(()=>[o(y,{class:"w-4 h-4 text-muted-foreground hover:text-destructive",name:"trash"})]),_:2},1032,["href"])),[[b,{message:e.__("Delete this shout permanently?")}]]):c("",!0)])):(r(),n("div",fe,[e.$page.props.auth.user&&t.permissions.delete?x((r(),g(f,{key:0,class:"focus:outline-none","preserve-state":!1,as:"button",method:"delete",href:e.route("shout.delete",t.id)},{default:d(()=>[o(y,{class:"w-4 h-4 text-muted-foreground hover:text-destructive",name:"trash"})]),_:2},1032,["href"])),[[b,{message:e.__("Delete this shout permanently?")}]]):c("",!0),s("div",pe,[s("div",ge,[s("div",xe,[x((r(),n("span",{class:"mr-1 text-xs text-primary-foreground/70 focus:outline-none",title:_.formatToDayDateString(t.created_at)},[u(l(_.formatTimeAgoToNow(t.created_at,!1)),1)],8,ye)),[[v]]),o(f,{as:"span",href:e.route("user.public.get",t.user.username),class:"font-semibold cursor-pointer hover:underline",style:S([t.user.roles[0].color?{color:t.user.roles[0].color}:null])},{default:d(()=>[u(l(t.user.username),1)]),_:2},1032,["href","style"])]),s("span",ve,l(t.message),1)])]),s("img",{src:t.user.profile_photo_url,alt:"My profile",class:"order-2 mt-2 w-8 h-8 rounded-full"},null,8,be)]))]))),128)),!i.loading&&(!i.shouts||i.shouts.length<=0)?(r(),n("div",we,l(e.__("No shouts yet.")),1)):c("",!0)]),e.$page.props.auth.user?(r(),n("div",ke,[i.loading?c("",!0):(r(),g(I,{key:0,ref:"inputbox",modelValue:i.message,"onUpdate:modelValue":h[0]||(h[0]=t=>i.message=t),disabled:i.sending,"aria-label":"Shout",type:"text",placeholder:e.__("Say something.."),onKeypress:K(T.sendShout,["enter"])},null,8,["modelValue","disabled","placeholder","onKeypress"])),i.error?(r(),n("span",Se,l(i.error),1)):c("",!0)])):(r(),n("div",Ce,[o(f,{class:"font-semibold text-primary",href:e.route("login")},{default:d(()=>[u(l(e.__("Login")),1)]),_:1},8,["href"]),e.$page.props.hasRegistrationFeature?(r(),n(C,{key:0},[u(l(" "+e.__("or"))+" ",1),o(f,{class:"font-semibold text-primary",href:e.route("register")},{default:d(()=>[u(l(e.__("Register")),1)]),_:1},8,["href"])],64)):c("",!0),u(" "+l(e.__("to Shout")),1)]))]),_:1})]),_:1},512)):c("",!0)}const Qe=L(M,[["render",Te]]);export{Qe as S};
