import{h as _,k as q,e as E,C as H,d as o,t as a,a as n,i as c,g as i,b as l,j as C,a1 as M,F as N,l as Q,w as r,W as R,o as t,n as b,c as y,R as W}from"./app-Do9q-MyE.js";import{_ as Y,a as j}from"./DangerButton-CwMZAScP.js";import{_ as v}from"./ConfirmsPassword-DPmPk4Ve.js";import{_ as T}from"./SecondaryButton-DJu7IFqX.js";import{_ as D}from"./XInput-CTxc_vGG.js";import{L as P}from"./LoadingButton-Cz_Frxmz.js";import"./index-oDi_KVMO.js";import"./index-DlYoUYeQ.js";import"./utils-D-KgF5mV.js";import"./DialogTitle-B9Dyifwy.js";import"./useForwardPropsEmits-L3e3_QW0.js";import"./x-DOdw7ujo.js";import"./Teleport-YoVnS0TY.js";import"./Input-BsT2nuw1.js";import"./Label-MSuCJuMN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./loader-circle-8BF3k2wr.js";const z={key:0,class:"text-lg font-medium text-foreground dark:text-foreground"},G={key:1,class:"text-lg font-medium text-foreground dark:text-foreground"},O={key:2,class:"text-lg font-medium text-foreground dark:text-foreground"},U={class:"mt-3 max-w-xl text-sm text-foreground dark:text-foreground"},I={key:3},J={key:0},X={class:"mt-4 max-w-xl text-sm text-foreground dark:text-foreground"},Z={key:0,class:"font-semibold"},ee={key:1},te=["innerHTML"],oe={key:0,class:"mt-4 max-w-xl text-sm text-foreground dark:text-foreground"},ae={class:"font-semibold"},se=["innerHTML"],re={key:1,class:"mt-4"},ne={key:1},ie={class:"mt-4 max-w-xl text-sm text-foreground dark:text-foreground"},le={class:"font-semibold"},ue={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-surface-100 dark:bg-surface-900 dark:text-foreground rounded-lg"},ce={class:"mt-5"},de={key:0,class:"flex items-center justify-end"},me={key:1},Le={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(B){const L=B,u=_(!1),s=_(!1),d=_(!1),g=_(null),w=_(null),h=_([]),m=q({code:""}),f=E(()=>{var e,p;return!u.value&&((p=(e=W().props.auth)==null?void 0:e.user)==null?void 0:p.two_factor_enabled)});H(f,()=>{f.value||(m.reset(),m.clearErrors())});const V=()=>{u.value=!0,R.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([A(),K(),x()]),onFinish:()=>{u.value=!1,s.value=L.requiresConfirmation}})},A=()=>axios.get("/user/two-factor-qr-code").then(e=>{g.value=e.data.svg}),K=()=>axios.get("/user/two-factor-secret-key").then(e=>{w.value=e.data.secretKey}),x=()=>axios.get("/user/two-factor-recovery-codes").then(e=>{h.value=e.data}),S=()=>{m.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{s.value=!1,g.value=null,w.value=null}})},$=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>x())},F=()=>{d.value=!0,R.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess:()=>{d.value=!1,s.value=!1}})};return(e,p)=>(t(),o("div",null,[f.value&&!s.value?(t(),o("h3",z,a(e.__("You have enabled two factor authentication.")),1)):f.value&&s.value?(t(),o("h3",G,a(e.__("Finish enabling two factor authentication.")),1)):(t(),o("h3",O,a(e.__("You have not enabled two factor authentication.")),1)),n("div",U,[n("p",null,a(e.__("When two factor authentication is enabled, you will be prompted for a secure, random token during authentication.You may retrieve this token from your phone's Google Authenticator application.")),1)]),f.value?(t(),o("div",I,[g.value?(t(),o("div",J,[n("div",X,[s.value?(t(),o("p",Z,a(e.__("To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code.")),1)):(t(),o("p",ee,a(e.__("Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key.")),1))]),n("div",{class:"mt-4 dark:bg-white dark:p-4 dark:rounded",innerHTML:g.value},null,8,te),w.value?(t(),o("div",oe,[n("p",ae,[c(a(e.__("Setup Key"))+": ",1),n("span",{innerHTML:w.value},null,8,se)])])):i("",!0),s.value?(t(),o("div",re,[l(D,{id:"code",modelValue:C(m).code,"onUpdate:modelValue":p[0]||(p[0]=k=>C(m).code=k),inputmode:"numeric",label:e.__("Code"),error:C(m).errors.code,autocomplete:"one-time-code",autofocus:"",class:"block mt-1 w-1/2",type:"text",name:"code",onKeyup:M(S,["enter"])},null,8,["modelValue","label","error"])])):i("",!0)])):i("",!0),h.value.length>0&&!s.value?(t(),o("div",ne,[n("div",ie,[n("p",le,a(e.__("Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost.")),1)]),n("div",ue,[(t(!0),o(N,null,Q(h.value,k=>(t(),o("div",{key:k},a(k),1))),128))])])):i("",!0)])):i("",!0),n("div",ce,[f.value?(t(),o("div",me,[l(v,{onConfirmed:S},{default:r(()=>[s.value?(t(),y(Y,{key:0,type:"button",class:b(["mr-3",{"opacity-25":u.value}]),disabled:u.value},{default:r(()=>[c(a(e.__("Confirm")),1)]),_:1},8,["class","disabled"])):i("",!0)]),_:1}),l(v,{onConfirmed:$},{default:r(()=>[h.value.length>0&&!s.value?(t(),y(T,{key:0,class:"mr-3"},{default:r(()=>[c(a(e.__("Regenerate Recovery Codes")),1)]),_:1})):i("",!0)]),_:1}),l(v,{onConfirmed:x},{default:r(()=>[h.value.length===0&&!s.value?(t(),y(T,{key:0,class:"mr-3"},{default:r(()=>[c(a(e.__("Show Recovery Codes")),1)]),_:1})):i("",!0)]),_:1}),l(v,{onConfirmed:F},{default:r(()=>[s.value?(t(),y(T,{key:0,class:b({"opacity-25":d.value}),disabled:d.value},{default:r(()=>[c(a(e.__("Cancel")),1)]),_:1},8,["class","disabled"])):i("",!0)]),_:1}),l(v,{onConfirmed:F},{default:r(()=>[s.value?i("",!0):(t(),y(j,{key:0,class:b({"opacity-25":d.value}),disabled:d.value},{default:r(()=>[c(a(e.__("Disable")),1)]),_:1},8,["class","disabled"]))]),_:1})])):(t(),o("div",de,[l(v,{onConfirmed:V},{default:r(()=>[l(P,{class:b({"opacity-25":u.value}),disabled:u.value},{default:r(()=>[c(a(e.__("Enable")),1)]),_:1},8,["class","disabled"])]),_:1})]))])]))}};export{Le as default};
