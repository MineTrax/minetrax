import{_ as V}from"./AdminLayout-CjagHNcW.js";import{u as Q}from"./useAuthorizable-B2TCKEv8.js";import{u as W}from"./BaseLayout-DfXV1WNK.js";import{m as $,a2 as R,y as z,z as j,c as f,w as n,s as F,o as i,b as l,j as e,a,i as _,t as s,g as p,v as k,P as y,d as c,q as D}from"./app-Bh5uq5T2.js";import{_ as L}from"./DataTable-BaXbvkK6.js";import{D as w}from"./DtRowItem-C0VH15na.js";import{_ as M}from"./AppBreadcrumb-CEuU89zV.js";import{_ as T}from"./index-Bvduyk2Y.js";import{u as Y}from"./index-BlQc97mu.js";import{_ as O}from"./AlertCard-Br8hCh2A.js";import{r as H}from"./ArrowPathIcon-CxWI3Cuk.js";import{r as G}from"./EyeIcon-G0h5gXDH.js";import{r as J}from"./PencilSquareIcon--OSl_KlB.js";import{r as K}from"./TrashIcon-DKFwl6gR.js";import"./CloudArrowDownIcon-peUI9MxF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Icon-B54a8he6.js";import"./useForwardPropsEmits-CoSvaN6q.js";import"./chevron-down-BM8GSVcu.js";import"./Teleport-C8LT0wZ6.js";import"./VisuallyHidden-C0pHwiql.js";import"./utils-D-KgF5mV.js";import"./x-Dxr5v1SF.js";import"./SelectValue-B7I_M8gp.js";import"./useFormControl-pZlKIA-M.js";import"./vue-multiselect.esm-lFmy1_TG.js";import"./XMarkIcon-CHsIiBI1.js";import"./Card-CzH_Id9h.js";import"./CardContent-Blze7ZpO.js";const U={class:"px-10 py-8 mx-auto text-foreground"},X={class:"italic text-foreground dark:text-foreground"},Z={class:"flex justify-between mb-4"},ee={class:"flex gap-2"},te={class:"px-4 py-4 text-sm text-center text-foreground whitespace-nowrap dark:text-foreground font-bold"},re={class:"flex items-center"},se={class:"flex-shrink-0 h-10 w-10"},oe=["src"],ae={class:"ml-4"},ne={class:"text-sm font-medium text-foreground dark:text-foreground"},ie={class:"text-sm text-foreground dark:text-foreground"},le={class:"group"},de={class:"text-sm filter blur-sm text-foreground dark:text-foreground group-hover:blur-none duration-300 cursor-text"},ce={class:"text-sm text-foreground dark:text-foreground filter blur-sm group-hover:blur-none duration-300 cursor-text"},ue={class:"px-4 space-y-1 whitespace-nowrap"},fe={class:"flex"},pe={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-surface-100 text-foreground dark:bg-opacity-25 dark:text-foreground"},xe={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-success-100 text-success-800 dark:bg-opacity-25 dark:text-success-400"},_e={key:2,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-error-100 text-error-800 dark:bg-opacity-25 dark:text-error-400"},me={class:"flex"},ye={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-surface-100 text-foreground dark:bg-opacity-25 dark:text-foreground"},he={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-success-100 text-success-800 dark:bg-opacity-25 dark:text-success-400"},ge={key:2,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-error-100 text-error-800 dark:bg-opacity-25 dark:text-error-400"},be={key:3},ve=["title"],ke={class:"px-6 py-4 space-x-2 text-sm font-medium text-right whitespace-nowrap"},we={key:0},Se={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-error-100 text-error-800 dark:bg-opacity-25 dark:text-error-400"},De={key:1,class:"space-x-2"},tt={__name:"IndexServer",props:{canCreateBungeeServer:Boolean,servers:Object,filters:Object},setup(h){const{can:g}=Q(),{__:r}=F(),{formatTimeAgoToNow:C,formatToDayDateString:E}=W(),B=Y("show-bungee-server-missing-alert",!0),I=h,N=[{text:r("Admin"),current:!1},{text:r("Servers"),current:!0}],q=[{key:"id",label:r("ID"),sortable:!0,class:"text-center font-bold"},{key:"name",sortable:!0,label:r("Name"),filterable:{type:"text"}},{key:"ip_address",label:r("IP:Port"),sortable:!0},{key:"type",label:r("Type"),sortable:!0},{key:"status",sortable:!1,label:r("Status")},{key:"minecraft_version",sortable:!0,label:r("Version")},{key:"created_at",sortable:!0,label:r("Added")},{key:"actions",label:r("Actions"),sortable:!1,class:"w-1/12 text-right"}],A=$({}),S=$({});R(()=>{I.servers.data.forEach(o=>{axios.get(route("server.ping.get",o.id)).then(u=>{D(()=>{var x,d,v,t;A[o.id]={online:1,players:(d=(x=u.data)==null?void 0:x.players)==null?void 0:d.online,max:(t=(v=u.data)==null?void 0:v.players)==null?void 0:t.max}})}).catch(()=>{D(()=>A[o.id]={online:0})}),o.webquery_port?axios.get(route("server.webquery.ping",o.id)).then(u=>{D(()=>{var x,d;S[o.id]={online:1,players:(x=u.data)==null?void 0:x.online_players,max:(d=u.data)==null?void 0:d.max_players}})}).catch(()=>{D(()=>S[o.id]={online:0})}):S[o.id]={online:-1}})});function b(o){return A[o]||null}function m(o){return S[o]||null}return(o,u)=>{const x=z("app-head"),d=j("tippy"),v=j("confirm");return i(),f(V,null,{default:n(()=>[l(x,{title:e(r)("Manage Servers")},null,8,["title"]),a("div",U,[h.canCreateBungeeServer&&e(B)?(i(),f(O,{key:0,"close-button":!0,"text-color":"text-primary dark:text-primary","border-color":"border-primary",onClose:u[0]||(u[0]=t=>B.value=!1)},{body:n(()=>[_(s(e(r)("Adding Proxy server is recommended if you are adding more than 1 server to MineTrax, so that it can be used to show whole network player count in homepage."))+" ",1),a("p",X,s(e(r)("Note: This is not an error. You can safely ignore this message if you don't want to add proxy server.")),1)]),default:n(()=>[_(s(e(r)("You don't have Bungee/Proxy Server Added!"))+" ",1)]),_:1})):p("",!0),a("div",Z,[l(M,{class:"mt-0","breadcrumb-class":"max-w-none px-0 md:px-0",items:N}),a("div",ee,[e(g)("create servers")?k((i(),f(e(T),{key:0,title:e(r)("Force Resync"),variant:"destructive",size:"icon","as-child":""},{default:n(()=>[l(e(y),{href:o.route("admin.server.force-scan"),method:"post",as:"button"},{default:n(()=>[l(e(H),{class:"w-5 h-5"})]),_:1},8,["href"])]),_:1},8,["title"])),[[d],[v,{title:"Force Resync!",message:"MineTrax automatically sync player stats every 30 minutes or as per schedule defined in .env file. You are about to force resync player statistics for all servers. Are you sure you want to proceed?"}]]):p("",!0),e(g)("create servers")?(i(),f(e(T),{key:1,"as-child":""},{default:n(()=>[l(e(y),{href:o.route("admin.server.create")},{default:n(()=>[_(s(e(r)("Add Server")),1)]),_:1},8,["href"])]),_:1})):p("",!0),e(g)("create servers")&&h.canCreateBungeeServer?(i(),f(e(T),{key:2,"as-child":""},{default:n(()=>[l(e(y),{href:o.route("admin.server.create-bungee")},{default:n(()=>[_(s(e(r)("Add Proxy Server")),1)]),_:1},8,["href"])]),_:1})):p("",!0)])]),l(L,{class:"bg-card rounded-lg shadow",header:q,data:h.servers,filters:h.filters},{default:n(({item:t})=>{var P;return[a("td",te,s(t.id),1),l(w,null,{default:n(()=>[a("div",re,[a("div",se,[a("img",{class:"h-10 w-10",src:t.country.photo_path,alt:"Country Flag"},null,8,oe)]),a("div",ae,[a("div",ne,s(t.name),1),a("div",ie,s(t.hostname),1)])])]),_:2},1024),l(w,null,{default:n(()=>[a("div",le,[a("div",de,s(t.masked_ip_address)+" : "+s(t.join_port),1),a("div",ce,s(e(r)("WebQuery: :webquery_port",{webquery_port:t.webquery_port||e(r)("not set")})),1)])]),_:2},1024),l(w,null,{default:n(()=>[_(s(t.type.key=="Bungee"?e(r)("Proxy"):t.type.key),1)]),_:2},1024),a("td",ue,[a("div",fe,[b(t.id)?b(t.id).online===1?(i(),c("span",xe,s(e(r)("Server"))+" ðŸŸ¢ "+s(b(t.id).players+"/"+b(t.id).max),1)):b(t.id).online===0?(i(),c("span",_e,s(e(r)("Server"))+" ðŸ”´ ",1)):p("",!0):(i(),c("span",pe,s(e(r)("Loading"))+"...",1))]),a("div",me,[m(t.id)?m(t.id).online===1?(i(),c("span",he,s(e(r)("WebQuery"))+" ðŸŸ¢ "+s(m(t.id).players+"/"+m(t.id).max),1)):m(t.id).online===0?(i(),c("span",ge,s(e(r)("WebQuery"))+" ðŸ”´ ",1)):m(t.id).online===-1?(i(),c("span",be)):p("",!0):(i(),c("span",ye,s(e(r)("Loading"))+"...",1))])]),l(w,null,{default:n(()=>[_(s(t.minecraft_version),1)]),_:2},1024),l(w,null,{default:n(()=>[k((i(),c("span",{title:e(E)(t.created_at)},[_(s(e(C)(t.created_at)),1)],8,ve)),[[d]])]),_:2},1024),a("td",ke,[(P=t==null?void 0:t.settings)!=null&&P.is_deleting?(i(),c("div",we,[a("span",Se,s(e(r)("Deleting...")),1)])):(i(),c("div",De,[k((i(),f(e(y),{as:"a",title:e(r)("View Server Intel"),href:o.route("admin.server.show",t.id),class:"inline-flex items-center justify-center text-primary hover:text-primary"},{default:n(()=>[l(e(G),{class:"inline-block w-5 h-5"})]),_:2},1032,["title","href"])),[[d]]),e(g)("update servers")?k((i(),f(e(y),{key:0,as:"a",href:o.route("admin.server.edit",t.id),class:"inline-flex items-center justify-center text-warning-600 dark:text-warning-500 hover:text-warning-800 dark:hover:text-warning-800",title:e(r)("Edit Server")},{default:n(()=>[l(e(J),{class:"inline-block w-5 h-5"})]),_:2},1032,["href","title"])),[[d]]):p("",!0),e(g)("delete servers")?k((i(),f(e(y),{key:1,as:"button",method:"DELETE",href:o.route("admin.server.delete",t.id),class:"inline-flex items-center justify-center text-error-600 hover:text-error-900 focus:outline-none",title:e(r)("Delete Server")},{default:n(()=>[l(e(K),{class:"inline-block w-5 h-5"})]),_:2},1032,["href","title"])),[[v,{title:"Delete Server?",message:"Are you sure you want to delete this Server permanently? Deleting a Server will also delete all of its associated data including all of its Player & Server Intel data. This action cannot be undone."}],[d]]):p("",!0)]))])]}),_:1},8,["data","filters"])])]),_:1})}}};export{tt as default};
