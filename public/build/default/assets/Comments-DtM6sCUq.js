import{I as v}from"./Icon-DyYhHgsS.js";import{_ as w}from"./UserDisplayname-DrgyYFYl.js";import{u as C}from"./AppLayout-D09sHPWy.js";import{s as f,z as _,o as n,d as a,e as i,a as o,p as d,x as M,t as c,F as T,g as B,n as D,b as p,w as h,f as L,c as N,m as V,v as A,a7 as S}from"./app-B6MSbjiR.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={components:{Icon:v,UserDisplayname:w},props:{commentable:Object,commentableType:String},setup(){const{purifyAndLinkifyText:e,formatTimeAgoToNow:r,formatToDayDateString:l}=C();return{purifyAndLinkifyText:e,formatTimeAgoToNow:r,formatToDayDateString:l}},data(){return{comments:null,loading:!0,loadingMore:!1,commentBody:"",submitting:!1,bodyerror:null,showLoadMoreCommentsButton:!0}},created(){axios.get(route(`${this.commentableType}.comment.index`,this.commentable.id)).then(e=>{this.comments=e.data,this.comments.data.reverse()}).finally(()=>{this.loading=!1})},methods:{loadMoreComments(){return this.comments.next_page_url?(this.loadingMore=!0,axios(this.comments.next_page_url).then(e=>{this.comments={...e.data,data:[...e.data.data.reverse(),...this.comments.data]}}).finally(()=>this.loadingMore=!1)):(this.showLoadMoreCommentsButton=!1,Promise.resolve())},submitComment(){this.submitting||(this.submitting=!0,this.bodyerror=null,axios.post(route(`${this.commentableType}.comment.store`,this.commentable.id),{comment:this.commentBody}).then(e=>{e.status===200&&(this.comments.data.push(e.data.data),this.commentBody="")}).catch(e=>{e.response.status===422?this.bodyerror=e.response.data.errors.comment[0]:this.bodyerror=e.response.data.message}).finally(()=>{this.submitting=!1,this.$nextTick(()=>{this.$refs.comment.focus()})}))}}},j={class:"flex flex-col"},F={key:0,class:"mt-0.5 dark:border-secondary-700"},I={key:1,class:"flex justify-center p-4"},K={class:"flex mt-3"},U={key:2,class:"flex justify-center pt-4 text-secondary-500 dark:text-secondary-400 text-sm"},E={key:3,class:"flex flex-col mt-3 space-y-2"},O={class:"items-start order-2 max-w-lg mx-2 space-y-2 text-sm"},P=["title"],W=["innerHTML"],q=["src"],G={key:4,class:"flex mt-1"},J=["src"],Q={class:"flex-grow order-2 mx-2 text-sm"},R=["disabled","placeholder"],X={key:0,class:"ml-2 text-xs text-error-500"};function Y(e,r,l,u,t,m){const x=f("user-displayname"),y=f("inertia-link"),b=f("icon"),g=_("tippy"),k=_("confirm");return n(),a("div",j,[l.commentableType=="post"?(n(),a("hr",F)):i("",!0),t.loading||t.loadingMore?(n(),a("div",I,r[4]||(r[4]=[o("svg",{class:"w-5 h-5 mr-3 -ml-1 animate-spin text-primary-600 dark:text-primary-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):i("",!0),d(o("div",K,[o("button",{class:"text-sm font-semibold text-secondary-500 dark:text-secondary-400 focus:outline-none hover:underline",onClick:r[0]||(r[0]=(...s)=>m.loadMoreComments&&m.loadMoreComments(...s))},c(e.__("View previous comments")),1)],512),[[M,!t.loadingMore&&!t.loading&&t.showLoadMoreCommentsButton&&t.comments&&t.comments.next_page_url]]),!t.loading&&t.comments&&t.comments.data.length===0?(n(),a("div",U,c(e.__("No comments yet")),1)):i("",!0),!t.loading&&t.comments?(n(),a("div",E,[(n(!0),a(T,null,B(t.comments.data,s=>(n(),a("div",{key:s.id,class:"flex"},[o("div",O,[o("div",{class:D(["flex flex-col px-4 py-2 text-secondary-700 bg-surface-100 rounded-tl-lg rounded-2xl dark:bg-surface-600 dark:bg-opacity-25 dark:text-secondary-200",{"border border-secondary-300 dark:border-secondary-700":e.$page.props.auth.user&&e.$page.props.auth.user.id===s.user_id}])},[p(y,{as:"a",class:"hover:cursor-pointer hover:underline",href:e.route("user.public.get",s.commentator.username)},{default:h(()=>[p(x,{user:s.commentator,"show-username":!0,"text-class":"font-sm"},{default:h(()=>[d((n(),a("span",{class:"inline ml-1 text-xs text-secondary-500 dark:text-secondary-400 focus:outline-none",title:u.formatToDayDateString(s.created_at)},[L(c(u.formatTimeAgoToNow(s.created_at)),1)],8,P)),[[g]])]),_:2},1032,["user"])]),_:2},1032,["href"]),o("span",{innerHTML:u.purifyAndLinkifyText(s.comment)},null,8,W)],2)]),o("img",{src:s.commentator.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,q),e.$page.props.auth.user&&s.permissions.delete?d((n(),N(y,{key:0,"preserve-scroll":!0,"preserve-state":!1,as:"button",method:"delete",href:e.route(`${l.commentableType}.comment.delete`,[l.commentable.id,s.id]),class:"order-3 focus:outline-none"},{default:h(()=>[p(b,{name:"trash",class:"w-4 h-4 text-secondary-200 hover:text-error-400 dark:text-secondary-500 dark:hover:text-error-500"})]),_:2},1032,["href"])),[[k,{message:e.__("Are you sure you want to delete this comment?")}]]):i("",!0)]))),128))])):i("",!0),e.$page.props.auth.user?(n(),a("div",G,[o("img",{src:e.$page.props.auth.user.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,J),o("div",Q,[o("form",{onSubmit:r[3]||(r[3]=V((...s)=>m.submitComment&&m.submitComment(...s),["prevent"]))},[d(o("input",{ref:"comment","onUpdate:modelValue":r[1]||(r[1]=s=>t.commentBody=s),disabled:t.submitting,placeholder:e.__("Write a comment..."),"aria-label":"comment",type:"text",class:"block w-full mt-1 bg-surface-100 border border-secondary-100 rounded-full dark:bg-surface-900 focus:border-secondary-300 dark:border-secondary-800 dark:focus:border-secondary-700 dark:text-secondary-200 focus:ring-0 sm:text-sm disabled:opacity-50",onKeypress:r[2]||(r[2]=S((...s)=>m.submitComment&&m.submitComment(...s),["enter"]))},null,40,R),[[A,t.commentBody]])],32),t.bodyerror?(n(),a("span",X,c(t.bodyerror),1)):i("",!0)])])):i("",!0)])}const oe=z(H,[["render",Y]]);export{oe as C};
