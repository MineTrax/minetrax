import{u as C}from"./BaseLayout-CyMXUReW.js";import{o as l,d as n,a,F as _,l as k,n as u,f as p,t as r,g as c,G as g,y as h,c as w,w as y,b as x,X as V}from"./app-Ia0bJDXi.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as S}from"./Card-xSJBqBdx.js";import{_ as T}from"./CardContent-CE_SpfjF.js";const B={name:"Poll",props:{question:{type:String,required:!1},answers:{type:Array,required:!1},showResults:{type:Boolean,default:!1},showTotalVotes:{type:Boolean,default:!0},finalResults:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},submitButtonText:{type:String,default:"Submit"},customId:{type:Number,default:0},isComingSoon:{type:Boolean,default:!1},started_at:{type:String,default:null},closed_at:{type:String,default:null}},setup(){const{formatTimeAgoToNow:e,formatToDayDateString:o}=C();return{formatTimeAgoToNow:e,formatToDayDateString:o}},data(){return{visibleResults:JSON.parse(this.showResults)}},computed:{totalVotes(){let e=0;return this.answers.filter(o=>{!isNaN(o.votes)&&o.votes>0&&(e+=parseInt(o.votes))}),e},totalVotesFormatted(){return this.totalVotes.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},mostVotes(){let e=0;return this.answers.filter(o=>{!isNaN(o.votes)&&o.votes>0&&o.votes>=e&&(e=o.votes)}),e},calcAnswers(){return this.totalVotes===0?this.answers.map(e=>(e.percent="0%",e)):this.answers.filter(e=>(!isNaN(e.votes)&&e.votes>0?e.percent=Math.round(parseInt(e.votes)/this.totalVotes*100)+"%":e.percent="0%",e))},totalSelections(){return this.calcAnswers.filter(e=>e.selected).length}},methods:{handleMultiple(){let e=[];this.calcAnswers.filter(t=>{t.selected&&(t.votes++,e.push({value:t.value,votes:t.votes}))}),this.visibleResults=!0;let o={arSelected:e,totalVotes:this.totalVotes};this.customId&&(o.customId=this.customId),this.$emit("addvote",o)},handleVote(e){if(this.isComingSoon)return;if(this.multiple){e.selected===void 0&&console.log("Please add 'selected: false' on the answer object"),e.selected=!e.selected;return}this.$page.props.auth.user&&(e.votes++,e.selected=!0,this.visibleResults=!0);let o={value:e.value,votes:e.votes,totalVotes:this.totalVotes};this.customId&&(o.customId=this.customId),this.$emit("addvote",o)}}},N={class:"vue-poll"},R=["innerHTML"],L={class:"ans-cnt"},M=["onClick"],A=["innerHTML"],P=["textContent"],H=["innerHTML"],I=["textContent"],j=["innerHTML"],q={key:0,class:"text-foreground text-xs italic"},F={class:"flex justify-between items-baseline"},D=["textContent"],z={key:1,class:"text-foreground text-xs italic"},O=["textContent"];function E(e,o,t,f,d,i){return l(),n("div",N,[a("h3",{class:"qst",innerHTML:t.question},null,8,R),a("div",L,[(l(!0),n(_,null,k(i.calcAnswers,(s,m)=>(l(),n("div",{key:m,class:u({ans:!0,[s.custom_class]:s.custom_class})},[t.finalResults?(l(),n(_,{key:1},[a("div",{class:u({"ans-voted final":!0,selected:s.selected})},[s.percent?(l(),n("span",{key:0,class:"percent",textContent:r(s.percent)},null,8,I)):c("",!0),a("span",{class:"txt",innerHTML:s.text},null,8,j)],2),a("span",{class:u({bg:!0,"bg-primary":i.mostVotes==s.votes,"bg-background":i.mostVotes!=s.votes}),style:g({width:s.percent})},null,6)],64)):(l(),n(_,{key:0},[d.visibleResults?(l(),n("div",{key:1,class:u({"ans-voted":!0,selected:s.selected})},[s.percent?(l(),n("span",{key:0,class:"percent",textContent:r(s.percent)},null,8,P)):c("",!0),a("span",{class:"txt",innerHTML:s.text},null,8,H)],2)):(l(),n("div",{key:0,class:u(["hover:bg-accent",{"ans-no-vote noselect":!0,active:s.selected}]),onClick:p(v=>i.handleVote(s),["prevent"])},[a("span",{class:"txt",innerHTML:s.text},null,8,A)],10,M)),a("span",{class:"bg bg-background",style:g({width:d.visibleResults?s.percent:"0%"})},null,4)],64))],2))),128))]),t.isComingSoon?(l(),n("div",q,r(e.__("Poll starting"))+" "+r(f.formatTimeAgoToNow(t.started_at)),1)):c("",!0),a("div",F,[t.showTotalVotes&&(d.visibleResults||t.finalResults)?(l(),n("div",{key:0,class:"votes",textContent:r(i.totalVotesFormatted+" votes")},null,8,D)):c("",!0),!t.isComingSoon&&t.closed_at&&!t.finalResults?(l(),n("div",z,r(e.__("Poll closing"))+" "+r(f.formatTimeAgoToNow(t.closed_at)),1)):c("",!0)]),!t.finalResults&&!d.visibleResults&&t.multiple&&i.totalSelections>0?(l(),n("a",{key:1,href:"#",class:"submit",onClick:o[0]||(o[0]=p((...s)=>i.handleMultiple&&i.handleMultiple(...s),["prevent"])),textContent:r(t.submitButtonText)},null,8,O)):c("",!0)])}const G=b(B,[["render",E]]),J={components:{Poll:G,Card:S,CardContent:T},props:{poll:Object,isListing:{type:Boolean,default:!1}},data(){return{options:this.poll}},methods:{addVote(e){this.poll.isComingSoon||this.$inertia.post(route("poll.vote",[this.poll.id,e.value]),null,{preserveState:!0,preserveScroll:!0})}}},X={key:0,class:"font-extrabold text-foreground dark:text-foreground"},K={key:1,class:"font-extrabold text-foreground dark:text-foreground"},Q={class:"mt-3 text-foreground dark:text-card-foreground"};function U(e,o,t,f,d,i){const s=h("poll"),m=h("CardContent"),v=h("Card");return t.poll?(l(),w(v,{key:0},{default:y(()=>[x(m,{class:"p-3 space-y-2 sm:px-5"},{default:y(()=>[t.isListing?c("",!0):(l(),n("h3",X,r(e.__("Latest Poll")),1)),t.isListing?(l(),n("h3",K,r(e.__("Poll"))+" "+r(t.poll.id),1)):c("",!0),a("div",Q,[x(s,V(d.options,{onAddvote:i.addVote}),null,16,["onAddvote"])])]),_:1})]),_:1})):c("",!0)}const te=b(J,[["render",U]]);export{te as P};
