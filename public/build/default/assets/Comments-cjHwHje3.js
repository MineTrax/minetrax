import{I as k}from"./Icon-B7smHmqf.js";import{_ as C}from"./UserDisplayname-C83Y_g92.js";import{u as M}from"./BaseLayout-DEET2uXb.js";import{_ as T}from"./Input-Jm5v012Z.js";import{y as c,z as y,o as r,d as i,g as m,a as s,v as f,Q as B,t as d,F as V,l as D,b as u,w as h,i as L,c as N,f as A,a3 as S}from"./app-U7F8fpli.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={components:{Icon:k,UserDisplayname:C,Input:T},props:{commentable:Object,commentableType:String},setup(){const{purifyAndLinkifyText:e,formatTimeAgoToNow:n,formatToDayDateString:l}=M();return{purifyAndLinkifyText:e,formatTimeAgoToNow:n,formatToDayDateString:l}},data(){return{comments:null,loading:!0,loadingMore:!1,commentBody:"",submitting:!1,bodyerror:null,showLoadMoreCommentsButton:!0}},created(){axios.get(route(`${this.commentableType}.comment.index`,this.commentable.id)).then(e=>{this.comments=e.data,this.comments.data.reverse()}).finally(()=>{this.loading=!1})},methods:{loadMoreComments(){return this.comments.next_page_url?(this.loadingMore=!0,axios(this.comments.next_page_url).then(e=>{this.comments={...e.data,data:[...e.data.data.reverse(),...this.comments.data]}}).finally(()=>this.loadingMore=!1)):(this.showLoadMoreCommentsButton=!1,Promise.resolve())},submitComment(){this.submitting||(this.submitting=!0,this.bodyerror=null,axios.post(route(`${this.commentableType}.comment.store`,this.commentable.id),{comment:this.commentBody}).then(e=>{e.status===200&&(this.comments.data.push(e.data.data),this.commentBody="")}).catch(e=>{e.response.status===422?this.bodyerror=e.response.data.errors.comment[0]:this.bodyerror=e.response.data.message}).finally(()=>{this.submitting=!1,this.$nextTick(()=>{this.$refs.comment.$el.focus()})}))}}},j={class:"flex flex-col"},z={key:0,class:"mt-0.5"},K={key:1,class:"flex justify-center p-4 px-3"},F={class:"flex mt-3 px-3"},U={key:2,class:"flex justify-center pt-4 text-sm text-muted-foreground px-3"},E={key:3,class:"flex flex-col mt-3 space-y-2"},O={class:"items-start order-2 max-w-lg mx-2 space-y-2 text-sm"},P={class:"flex flex-col px-1.5 py-2"},Q=["title"],W=["innerHTML"],q=["src"],G={key:4,class:"flex my-2 px-3"},J=["src"],R={class:"flex-grow order-2 mx-2 text-sm"},X={key:0,class:"ml-2 text-xs text-error-500"};function Y(e,n,l,p,t,a){const x=c("user-displayname"),_=c("inertia-link"),g=c("icon"),b=c("Input"),v=y("tippy"),w=y("confirm");return r(),i("div",j,[l.commentableType=="post"?(r(),i("hr",z)):m("",!0),t.loading||t.loadingMore?(r(),i("div",K,n[3]||(n[3]=[s("svg",{class:"w-5 h-5 mr-3 -ml-1 animate-spin text-primary dark:text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):m("",!0),f(s("div",F,[s("button",{class:"text-sm font-semibold text-foreground dark:text-foreground focus:outline-none hover:underline",onClick:n[0]||(n[0]=(...o)=>a.loadMoreComments&&a.loadMoreComments(...o))},d(e.__("View previous comments")),1)],512),[[B,!t.loadingMore&&!t.loading&&t.showLoadMoreCommentsButton&&t.comments&&t.comments.next_page_url]]),!t.loading&&t.comments&&t.comments.data.length===0?(r(),i("div",U,d(e.__("No comments yet")),1)):m("",!0),!t.loading&&t.comments?(r(),i("div",E,[(r(!0),i(V,null,D(t.comments.data,o=>(r(),i("div",{key:o.id,class:"flex border-b border-border last:border-b-0 px-3"},[s("div",O,[s("div",P,[u(_,{as:"a",class:"hover:cursor-pointer hover:underline",href:e.route("user.public.get",o.commentator.username)},{default:h(()=>[u(x,{user:o.commentator,"show-username":!0,"text-class":"font-sm"},{default:h(()=>[f((r(),i("span",{class:"inline ml-1 text-xs text-muted-foreground focus:outline-none",title:p.formatToDayDateString(o.created_at)},[L(d(p.formatTimeAgoToNow(o.created_at)),1)],8,Q)),[[v]])]),_:2},1032,["user"])]),_:2},1032,["href"]),s("span",{innerHTML:p.purifyAndLinkifyText(o.comment)},null,8,W)])]),s("img",{src:o.commentator.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,q),e.$page.props.auth.user&&o.permissions.delete?f((r(),N(_,{key:0,"preserve-scroll":!0,"preserve-state":!1,as:"button",method:"delete",href:e.route(`${l.commentableType}.comment.delete`,[l.commentable.id,o.id]),class:"order-3 focus:outline-none text-muted-foreground"},{default:h(()=>[u(g,{name:"trash",class:"w-4 h-4 text-muted-foreground hover:text-destructive"})]),_:2},1032,["href"])),[[w,{message:e.__("Are you sure you want to delete this comment?")}]]):m("",!0)]))),128))])):m("",!0),e.$page.props.auth.user?(r(),i("div",G,[s("img",{src:e.$page.props.auth.user.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 rounded-full"},null,8,J),s("div",R,[s("form",{onSubmit:n[2]||(n[2]=A((...o)=>a.submitComment&&a.submitComment(...o),["prevent"]))},[u(b,{ref:"comment",modelValue:t.commentBody,"onUpdate:modelValue":n[1]||(n[1]=o=>t.commentBody=o),disabled:t.submitting,placeholder:e.__("Write a comment..."),"aria-label":"comment",type:"text",onKeypress:S(a.submitComment,["enter"])},null,8,["modelValue","disabled","placeholder","onKeypress"])],32),t.bodyerror?(r(),i("span",X,d(t.bodyerror),1)):m("",!0)])])):m("",!0)])}const re=I(H,[["render",Y]]);export{re as C};
