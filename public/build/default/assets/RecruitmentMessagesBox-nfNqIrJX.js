import{o as a,d as l,a as m,U as K,h as p,H as W,p as O,D as Q,y as G,z as V,t as v,c as x,w as _,i as L,g as f,j as s,b as g,F as D,l as J,v as y,n as w,a3 as P,f as X,q as j}from"./app-CCKLH5ME.js";import{L as Y}from"./LoadingSpinner-mRN1OuPz.js";import{_ as ee}from"./XTextarea-CKgEP4Pn.js";import{L as E}from"./LoadingButton-Bjoy-Inx.js";import{u as se}from"./BaseLayout-EMqiVgMT.js";import{u as te}from"./useAuthorizable-BcHdws2r.js";import{_ as U}from"./UserDisplayname-CmytMFC0.js";import{I as re}from"./Icon-DlyfKWQ8.js";import{_ as ae}from"./CommonStatusBadge-DhJOpYMk.js";import{_ as ie}from"./AlertCard-DxQ-1NO6.js";function ne(u,A){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})])}function q(u,A){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[m("path",{"fill-rule":"evenodd",d:"M12.516 2.17a.75.75 0 0 0-1.032 0 11.209 11.209 0 0 1-7.877 3.08.75.75 0 0 0-.722.515A12.74 12.74 0 0 0 2.25 9.75c0 5.942 4.064 10.933 9.563 12.348a.749.749 0 0 0 .374 0c5.499-1.415 9.563-6.406 9.563-12.348 0-1.39-.223-2.73-.635-3.985a.75.75 0 0 0-.722-.516l-.143.001c-2.996 0-5.717-1.17-7.734-3.08Zm3.094 8.016a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}const oe={class:"flex flex-col p-4 space-y-4"},le={class:"font-extrabold text-foreground dark:text-foreground text-lg"},ue={key:1,class:"flex items-center justify-center p-4 min-h-28"},de={id:"messagesContainer",class:"overflow-y-auto min-h-64 max-h-96"},me={key:0,class:"flex justify-center pt-4 text-sm text-foreground dark:text-foreground"},ce={key:1,class:"flex flex-col mt-3 mr-4 space-y-2"},fe={key:0,class:"italic text-sm text-foreground dark:text-foreground"},ge={class:"mr-1"},pe=["title"],_e=["src"],he=["title"],ve={key:0,class:"absolute -top-1 -right-1 w-3 h-3 bg-error-500 rounded-full animate-pulse"},be=["title"],xe=["innerHTML"],ye={id:"send-message",class:"mt-4"},we={class:"flex justify-end mt-2"},Ne={__name:"RecruitmentMessagesBox",props:{submission:{type:Object,required:!0},forAdmin:{type:Boolean,default:!1}},setup(u){const{purifyAndLinkifyText:A,formatTimeAgoToNow:C,formatToDayDateString:I}=se(),{can:R}=te(),k=K().props.auth.user,d=u,M=p("");let o=p([]),S=p(null),h=p(!0),c=p(!1),T=p(null);const $=p(null),z=d.forAdmin?route("admin.recruitment-submission.message.index",{submission:d.submission.id}):route("recruitment-submission.message.index",{recruitment:d.submission.recruitment.slug,submission:d.submission.id}),F=d.forAdmin?route("admin.recruitment-submission.message.store",{submission:d.submission.id}):route("recruitment-submission.message.store",{recruitment:d.submission.recruitment.slug,submission:d.submission.id}),H=()=>{j(()=>{const t=document.getElementById("messagesContainer");t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})};W(o,()=>{H()}),O(async()=>{h.value=!0,axios.get(z).then(t=>{o.value=t.data}).finally(()=>{h.value=!1,H()}),S.value=setInterval(()=>Z(),5e3)}),Q(()=>{clearInterval(S.value)});const N=t=>{const r=t.filter(i=>!o.value.some(n=>n.id===i.id));r.length>0&&(r.forEach(i=>{k&&i.commentator.id!==k.id&&(i.is_new=!0)}),o.value=[...o.value,...r],r.forEach(i=>{k&&i.commentator.id!==k.id&&setTimeout(()=>{const n=o.value.find(B=>B.id===i.id);n&&(n.is_new=!1)},3e4)}))},b=(t=null)=>{c.value||(c.value=!0,T.value=null,axios.post(F,{message:M.value,type:t}).then(r=>{r.status===200&&N([r.data.data])}).catch(r=>{var i,n;T.value=((n=(i=r.response)==null?void 0:i.data)==null?void 0:n.message)||r.message||"Something went wrong."}).finally(()=>{M.value="",c.value=!1,j(()=>{$.value.focus()})}))},Z=()=>{const t=o.value.length>0?o.value[o.value.length-1].id:0,r=d.forAdmin?route("admin.recruitment-submission.message.index",{submission:d.submission.id,after:t}):route("recruitment-submission.message.index",{recruitment:d.submission.recruitment.slug,submission:d.submission.id,after:t});axios.get(r).then(i=>{const n=i.data;n.length>0&&N(n)})};return(t,r)=>{const i=G("InertiaLink"),n=V("tippy"),B=V("confirm");return a(),l("div",oe,[m("h3",le,v(t.__("Messages Box")),1),u.forAdmin&&!u.submission.recruitment.is_allow_messages_from_users?(a(),x(ie,{key:0,variant:"destructive"},{default:_(()=>[L(v(t.__("Messages feature is disabled for this recruitment. Applicant can't send messages.")),1)]),_:1})):f("",!0),s(h)?(a(),l("div",ue,[g(Y,{loading:s(h)},null,8,["loading"])])):f("",!0),m("div",de,[!s(h)&&s(o)&&s(o).length===0?(a(),l("div",me,v(t.__("No messages found.")),1)):f("",!0),!s(h)&&s(o)&&s(o).length>0?(a(),l("div",ce,[(a(!0),l(D,null,J(s(o),e=>(a(),l("div",{key:e.id,class:"flex space-y-2"},[e.type.value==="recruitment_action"?(a(),l("div",fe,[g(i,{as:"span",class:"hover:cursor-pointer inline-block",href:t.route("user.public.get",e.commentator.username)},{default:_(()=>[g(U,{user:e.commentator,"show-username":!1,"show-badges":!1,"text-class":"font-sm"},null,8,["user"])]),_:2},1032,["href"]),m("span",ge,v(t.__(" changed application status to ")),1),g(ae,{status:e.comment},null,8,["status"]),y((a(),l("span",{class:"inline ml-1 text-xs text-foreground dark:text-foreground focus:outline-none",title:s(I)(e.created_at)},[L(v(s(C)(e.created_at)),1)],8,pe)),[[n]])])):(a(),l(D,{key:1},[m("img",{src:e.commentator.profile_photo_url,alt:"My profile",class:w(["w-8 h-8 mt-2 rounded-full",{"order-4":e.type.value==="recruitment_applicant_message"}])},null,10,_e),e.type.value==="recruitment_staff_whisper"?y((a(),l("div",{key:0,class:w(["flex mt-3.5 ml-1",{"order-3":e.type.value==="recruitment_applicant_message"}]),title:t.__("This is a whisper message only visible to staff")},[g(s(q),{class:"w-5 h-5 text-warning-400 dark:text-warning-300"})],10,he)),[[n]]):f("",!0),m("div",{class:w(["items-start w-full mx-2 space-y-2 text-sm",{"order-2 text-right":e.type.value==="recruitment_applicant_message"}])},[m("div",{class:w(["relative flex flex-col px-4 py-2 text-foreground rounded-2xl",{"bg-amber-100 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-900/50":e.type.value==="recruitment_staff_whisper","bg-secondary text-secondary-foreground":e.type.value==="recruitment_staff_message","bg-muted text-muted-foreground":e.type.value==="recruitment_applicant_message"}])},[e.is_new?(a(),l("span",ve)):f("",!0),g(i,{as:"a",class:"hover:cursor-pointer hover:underline",href:t.route("user.public.get",e.commentator.username)},{default:_(()=>[g(U,{user:e.commentator,"show-username":!0,"text-class":"font-sm"},{default:_(()=>[y((a(),l("span",{class:"inline ml-1 text-xs text-foreground dark:text-foreground focus:outline-none",title:s(I)(e.created_at)},[L(v(s(C)(e.created_at)),1)],8,be)),[[n]])]),_:2},1032,["user"])]),_:2},1032,["href"]),m("p",{class:"leading-snug break-words whitespace-pre-line md:leading-normal",innerHTML:s(A)(e.comment)},null,8,xe)],2)],2),s(R)("delete recruitment_submission_messages")&&u.forAdmin?y((a(),x(i,{key:1,"preserve-scroll":!0,"preserve-state":!1,as:"button",method:"delete",href:t.route("admin.recruitment-submission.message.delete",[u.submission.id,e.id]),class:w(["focus:outline-none",{"order-1":e.type.value==="recruitment_applicant_message"}])},{default:_(()=>[g(re,{name:"trash",class:"w-4 h-4 text-foreground hover:text-error-400 dark:text-foreground dark:hover:text-error-500"})]),_:2},1032,["href","class"])),[[B,{message:t.__("Are you sure you want to delete this comment?")}]]):f("",!0)],64))]))),128))])):f("",!0)]),m("div",ye,[g(ee,{ref_key:"inputbox",ref:$,modelValue:M.value,"onUpdate:modelValue":r[0]||(r[0]=e=>M.value=e),disabled:!u.submission.i_can_send_message||s(c),placeholder:"Write your message here... (Shift + Enter to send)",class:"w-full",error:s(T),onKeydown:r[1]||(r[1]=P(X(e=>u.forAdmin?b("recruitment_staff_message"):b(),["shift","exact","prevent"]),["enter"]))},null,8,["modelValue","disabled","error"]),m("div",we,[u.forAdmin?y((a(),x(E,{key:0,disabled:!u.submission.i_can_send_message||s(c),title:t.__("Send whisper to other staff members. This message will be private and only visible to staff members."),class:"px-4 py-2 mr-2 font-bold text-warning-500 bg-transparent rounded hover:text-warning-400 dark:text-white disabled:cursor-not-allowed disabled:opacity-25",loading:s(c),onClick:r[2]||(r[2]=e=>b("recruitment_staff_whisper"))},{default:_(()=>[s(c)?f("",!0):(a(),x(s(q),{key:0,class:"w-5 h-5"}))]),_:1},8,["disabled","title","loading"])),[[n]]):f("",!0),g(E,{disabled:!u.submission.i_can_send_message||s(c),class:"px-4 py-2",loading:s(c),onClick:r[3]||(r[3]=e=>u.forAdmin?b("recruitment_staff_message"):b())},{default:_(()=>[s(c)?f("",!0):(a(),x(s(ne),{key:0,class:"w-5 h-5"}))]),_:1},8,["disabled","loading"])])])])}}};export{Ne as _};
