import{I as D}from"./Icon-wreK45eH.js";import{u as N}from"./BaseLayout-sXkR-4Uw.js";import{aB as v,s as b,z as k,o as t,d as r,a as o,t as a,Z as I,e as l,F as w,g as B,p as f,v as V,a7 as C,b as c,w as h,f as d,y as S,c as T}from"./app-jpCRGzWE.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={components:{Icon:D},setup(){const{formatTimeAgoToNow:e,formatToDayDateString:i}=N();return{formatTimeAgoToNow:e,formatToDayDateString:i}},data(){return{shouts:[],message:"",error:null,loading:!0,sending:!1,shoutQueryInterval:null}},created(){this.$page.props.generalSettings.enable_shoutbox&&(axios.get(route("shout.index")).then(e=>{this.shouts=e.data}).finally(()=>{this.loading=!1}),v?Echo.channel("shouts").listen("ShoutCreated",e=>{this.shouts.unshift(e.data)}):this.shoutQueryInterval=setInterval(()=>this.pollServerForNewShouts(),5e3))},unmounted(){this.shoutQueryInterval&&clearInterval(this.shoutQueryInterval)},methods:{sendShout(){this.sending=!0,this.error=null,axios.post(route("shout.store"),{message:this.message}).then(e=>{e.status===200&&this.shouts.unshift(e.data)}).catch(e=>{e.response.status===422?this.error=e.response.data.errors.message[0]:e.response.status===403?this.error=e.response.data.message:this.error=this.__("Something went wrong. Try again.")}).finally(()=>{this.message="",this.sending=!1,this.$nextTick(()=>{this.$refs.inputbox.focus()})})},pollServerForNewShouts(){if(v)return;const e=this.shouts.length>0?this.shouts[0].id:0;axios.get(route("shout.index",{after:e})).then(i=>{const m=i.data;m.length>0&&(this.shouts=[...m,...this.shouts])})}}},Q={key:0},j={class:"p-3 space-y-4 bg-white rounded shadow dark:bg-surface-800"},A={class:"font-extrabold text-secondary-800 dark:text-secondary-200"},K={class:"flex-col space-y-4 overflow-auto max-h-96 hide-scrollbar"},M={key:0,class:"space-y-4"},z={key:0,class:"flex"},L={class:"items-start order-2 max-w-xs mx-2 space-y-2 text-sm"},R={class:"flex flex-col inline-block px-4 py-2 text-secondary-700 bg-surface-100 rounded-tl-lg rounded-2xl dark:bg-surface-600 dark:bg-opacity-25 dark:text-secondary-200"},U=["title"],H={class:"text-justify"},O=["src"],W={key:1,class:"flex justify-end"},Z={class:"items-start order-1 max-w-xs mx-2 space-y-2 text-sm"},q={class:"flex flex-col inline-block px-4 py-2 text-secondary-700 rounded-tr-lg rounded-2xl bg-primary-100 dark:bg-surface-900 dark:bg-opacity-40 dark:text-secondary-200"},G={class:"text-right"},J=["title"],P={class:"text-justify"},X=["src"],Y={key:1,class:"italic text-secondary-500 dark:text-secondary-400 text-center"},$={key:0},ee=["disabled","placeholder"],se={key:1,class:"text-xs text-error-400"},te={key:1,class:"text-sm text-center text-secondary-600 dark:text-secondary-400"};function re(e,i,m,p,n,g){const u=b("inertia-link"),y=b("icon"),_=k("tippy"),x=k("confirm");return e.$page.props.generalSettings.enable_shoutbox?(t(),r("div",Q,[o("div",j,[o("h3",A,a(e.__("Shout Box")),1),o("div",K,[n.loading?(t(),r("div",M,i[2]||(i[2]=[I('<div class="w-full max-w-sm mx-auto"><div class="flex space-x-4 animate-pulse"><div class="w-8 h-8 bg-surface-300 rounded-full dark:bg-surface-700"></div><div class="flex-1 py-1 space-y-1"><div class="w-3/4 h-4 bg-surface-300 rounded dark:bg-surface-700"></div><div class="w-5/6 h-4 bg-surface-300 rounded dark:bg-surface-700"></div></div></div></div><div class="w-full max-w-sm mx-auto"><div class="flex space-x-4 animate-pulse"><div class="w-8 h-8 bg-surface-300 rounded-full dark:bg-surface-700"></div><div class="flex-1 py-1 space-y-1"><div class="w-3/4 h-4 bg-surface-300 rounded dark:bg-surface-700"></div><div class="w-5/6 h-4 bg-surface-300 rounded dark:bg-surface-700"></div></div></div></div>',2)]))):l("",!0),(t(!0),r(w,null,B(n.shouts,s=>(t(),r("div",{key:s.id,class:"chat-message"},[!e.$page.props.auth.user||s.user_id!==e.$page.props.auth.user.id?(t(),r("div",z,[o("div",L,[o("div",R,[o("div",null,[c(u,{as:"span",href:e.route("user.public.get",s.user.username),class:"font-semibold cursor-pointer hover:underline",style:S([s.user.roles[0].color?{color:s.user.roles[0].color}:null])},{default:h(()=>[d(a(s.user.username),1)]),_:2},1032,["href","style"]),f((t(),r("span",{class:"ml-1 text-xs text-secondary-500 dark:text-secondary-400 focus:outline-none",title:p.formatToDayDateString(s.created_at)},[d(a(p.formatTimeAgoToNow(s.created_at,!1)),1)],8,U)),[[_]])]),o("span",H,a(s.message),1)])]),o("img",{src:s.user.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,O),e.$page.props.auth.user&&s.permissions.delete?f((t(),T(u,{key:0,class:"order-3 focus:outline-none","preserve-state":!1,as:"button",method:"delete",href:e.route("shout.delete",s.id)},{default:h(()=>[c(y,{class:"w-4 h-4 text-secondary-200 dark:text-secondary-500 hover:text-error-400 dark:hover:text-error-500",name:"trash"})]),_:2},1032,["href"])),[[x,{message:e.__("Delete this shout permanently?")}]]):l("",!0)])):(t(),r("div",W,[e.$page.props.auth.user&&s.permissions.delete?f((t(),T(u,{key:0,class:"focus:outline-none","preserve-state":!1,as:"button",method:"delete",href:e.route("shout.delete",s.id)},{default:h(()=>[c(y,{class:"w-4 h-4 text-secondary-200 dark:text-secondary-500 hover:text-error-400 dark:hover:text-error-500",name:"trash"})]),_:2},1032,["href"])),[[x,{message:e.__("Delete this shout permanently?")}]]):l("",!0),o("div",Z,[o("div",q,[o("div",G,[f((t(),r("span",{class:"mr-1 text-xs text-secondary-500 dark:text-secondary-400 focus:outline-none",title:p.formatToDayDateString(s.created_at)},[d(a(p.formatTimeAgoToNow(s.created_at,!1)),1)],8,J)),[[_]]),c(u,{as:"span",href:e.route("user.public.get",s.user.username),class:"font-semibold cursor-pointer hover:underline",style:S([s.user.roles[0].color?{color:s.user.roles[0].color}:null])},{default:h(()=>[d(a(s.user.username),1)]),_:2},1032,["href","style"])]),o("span",P,a(s.message),1)])]),o("img",{src:s.user.profile_photo_url,alt:"My profile",class:"order-2 w-8 h-8 mt-2 rounded-full"},null,8,X)]))]))),128)),!n.loading&&(!n.shouts||n.shouts.length<=0)?(t(),r("div",Y,a(e.__("No shouts yet.")),1)):l("",!0)]),e.$page.props.auth.user?(t(),r("div",$,[n.loading?l("",!0):f((t(),r("input",{key:0,ref:"inputbox","onUpdate:modelValue":i[0]||(i[0]=s=>n.message=s),disabled:n.sending,"aria-label":"Shout",class:"block w-full mt-1 bg-surface-100 border-none rounded-md focus:ring-secondary-300 sm:text-sm disabled:opacity-50 focus:bg-white dark:bg-surface-900 dark:text-secondary-200 dark:focus:bg-surface-900 dark:focus:ring-secondary-700",type:"text",placeholder:e.__("Say something.."),onKeypress:i[1]||(i[1]=C((...s)=>g.sendShout&&g.sendShout(...s),["enter"]))},null,40,ee)),[[V,n.message]]),n.error?(t(),r("span",se,a(n.error),1)):l("",!0)])):(t(),r("div",te,[c(u,{class:"font-semibold text-primary-500",href:e.route("login")},{default:h(()=>[d(a(e.__("Login")),1)]),_:1},8,["href"]),e.$page.props.hasRegistrationFeature?(t(),r(w,{key:0},[d(a(" "+e.__("or"))+" ",1),c(u,{class:"font-semibold text-primary-500",href:e.route("register")},{default:h(()=>[d(a(e.__("Register")),1)]),_:1},8,["href"])],64)):l("",!0),d(" "+a(e.__("to Shout")),1)]))])])):l("",!0)}const le=E(F,[["render",re]]);export{le as S};
