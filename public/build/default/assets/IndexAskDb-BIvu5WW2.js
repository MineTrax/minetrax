import{h as w,i as C,r as q,j as A,k as L,c as V,w as _,o as r,b as y,u as s,_ as I,a as e,d as l,t as d,e as p,n as E,F as v,g as T,l as Z,m as W,v as j,f as N,P,p as F}from"./app-luBSUb-y.js";import{_ as K}from"./AdminLayout-ChYp5Oxc.js";import{L as S}from"./LoadingSpinner-CVw1YAXh.js";import{I as $}from"./Icon-DeiOO_W9.js";import"./AppLayout-5FPtFZxB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuthorizable-BSHISSy0.js";import"./keyboard-CdSDiPUN.js";import"./open-closed-D1_kXgls.js";import"./CloudArrowDownIcon-GSSk-rVh.js";import"./index-CE5LmwrU.js";const z={class:"p-10 mx-auto space-y-4 max-w-5xl h-[94vh] flex flex-col"},Y={key:0,class:"p-5 mb-2 text-center text-red-500 bg-white rounded dark:bg-gray-800"},G={id:"logo",class:"flex items-center justify-center mt-8"},Q={class:"text-4xl font-bold text-gray-500 dark:text-gray-500"},U={class:"text-sm text-center text-gray-700 dark:text-gray-400"},J={id:"examples"},O={class:"mt-12 mb-2 text-xl font-bold text-center text-gray-500"},R={class:"grid grid-cols-2 gap-4"},X=["disabled","onClick"],ee={key:1,id:"results",class:"space-y-8 text-gray-800 dark:text-gray-300"},te={key:0,class:"flex justify-end w-full"},ae=["innerHTML"],re={key:1,class:"flex w-full"},se=["innerHTML"],oe={key:0,class:"text-xs text-gray-500 mt-0.5 italic"},le={class:""},ne={class:"flex"},ie={class:"w-full"},de={class:"relative"},ue=["placeholder","disabled"],ce=["disabled"],pe={key:0,xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ge={class:"mt-1"},he={key:0,class:"text-sm text-right text-red-400"},me={key:1,class:"p-2 text-sm text-center text-red-400 bg-white rounded shadow dark:bg-gray-800"},ye={class:"mt-2 hidden lg:block text-xs text-center text-gray-500"},De={__name:"IndexAskDb",props:{featureEnabled:{type:Boolean,required:!0},appDebug:{type:Boolean,required:!0},chatHistory:{type:Array,default:()=>[]}},setup(u){const{__:i}=F(),b=u,t=w({prompt:null,loading:!1,error:null,verboseError:null}),H=C(()=>!c.length&&t.loading===!1);let c=w(b.chatHistory);function f(){if(!b.featureEnabled||t.loading||!t.prompt)return;t.loading=!0,t.error=null,t.verboseError=null,c.push({type:"user",content:t.prompt}),x();const n=t.prompt;t.prompt=null,axios.post(route("admin.ask-db.query"),{prompt:n}).then(o=>{c.push(o.data.data)}).catch(o=>{var a,g,h,k;t.error=((g=(a=o.response)==null?void 0:a.data)==null?void 0:g.message)||o.message||i("Failed to Query Database! Try again after rephrasing your question."),b.appDebug&&(t.verboseError=((k=(h=o.response)==null?void 0:h.data)==null?void 0:k.verbose)||null),t.prompt=n,c.pop()}).finally(()=>{t.loading=!1,x()})}function B(n){n&&(t.loading||(t.prompt=n,f()))}function D(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),f())}const M=["Who is the most recent user to signup?","Give 5 recent users who have linked their players.","Which player has the most player kills?","Which server has most number of players?","How many user have their email verified?","How many post is created by superadmin?"],m=q(null);A(()=>{x()});function x(){m.value&&L(()=>{m.value.scrollTo({top:m.value.scrollHeight,behavior:"smooth"})})}return(n,o)=>(r(),V(K,null,{default:_(()=>[y(I,{title:s(i)("AskDB - AI based database query.")},null,8,["title"]),e("div",z,[u.featureEnabled?p("",!0):(r(),l("div",Y,d(s(i)("This feature is not enabled!")),1)),e("div",{id:"container",ref_key:"container",ref:m,class:E(["pr-2 overflow-y-auto grow",{"opacity-25":!u.featureEnabled}])},[H.value?(r(),l(v,{key:0},[e("div",G,[o[1]||(o[1]=e("svg",{class:"w-16 mr-2 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",pathfill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"data-v-94a7a0d7":"",fill:"currentColor",d:"M18.5 10.255c0 .044 0 .089-.003.133A1.537 1.537 0 0 0 17.473 10c-.162 0-.32.025-.473.074V5.75a.75.75 0 0 0-.75-.75h-8.5a.75.75 0 0 0-.75.75v4.505c0 .414.336.75.75.75h8.276l-.01.025-.003.012-.45 1.384-.01.026a1.625 1.625 0 0 1-.019.053H7.75a2.25 2.25 0 0 1-2.25-2.25V5.75A2.25 2.25 0 0 1 7.75 3.5h3.5v-.75a.75.75 0 0 1 .649-.743L12 2a.75.75 0 0 1 .743.649l.007.101-.001.75h3.5a2.25 2.25 0 0 1 2.25 2.25v4.505Zm-5.457 3.781.112-.036H6.254a2.25 2.25 0 0 0-2.25 2.25v.907a3.75 3.75 0 0 0 1.305 2.844c1.563 1.343 3.802 2 6.691 2 2.076 0 3.817-.339 5.213-1.028a1.545 1.545 0 0 1-1.169-1.003l-.004-.012-.03-.093c-1.086.422-2.42.636-4.01.636-2.559 0-4.455-.556-5.713-1.638a2.25 2.25 0 0 1-.783-1.706v-.907a.75.75 0 0 1 .75-.75H12v-.003a1.543 1.543 0 0 1 1.031-1.456l.012-.005ZM10.999 7.75a1.25 1.25 0 1 0-2.499 0 1.25 1.25 0 0 0 2.499 0ZM14.242 6.5a1.25 1.25 0 1 1 0 2.499 1.25 1.25 0 0 1 0-2.499Zm1.847 10.912a2.831 2.831 0 0 0-1.348-.955l-1.377-.448a.544.544 0 0 1 0-1.025l1.377-.448a2.84 2.84 0 0 0 1.76-1.762l.01-.034.449-1.377a.544.544 0 0 1 1.026 0l.448 1.377a2.837 2.837 0 0 0 1.798 1.796l1.378.448.027.007a.544.544 0 0 1 0 1.025l-1.378.448a2.839 2.839 0 0 0-1.798 1.796l-.447 1.377a.55.55 0 0 1-.2.263.544.544 0 0 1-.827-.263l-.448-1.377a2.834 2.834 0 0 0-.45-.848Zm7.694 3.801-.765-.248a1.577 1.577 0 0 1-.999-.998l-.249-.765a.302.302 0 0 0-.57 0l-.249.764a1.577 1.577 0 0 1-.983.999l-.766.248a.302.302 0 0 0 0 .57l.766.249a1.576 1.576 0 0 1 .998 1.002l.25.764a.303.303 0 0 0 .57 0l.248-.764a1.575 1.575 0 0 1 1-.999l.765-.248a.302.302 0 0 0 0-.57l-.016-.004Z"})],-1)),e("h1",Q,d(s(i)("Ask DB")),1)]),e("p",U,d(s(i)("Ask DB is an AI based database query system. You can ask questions in natural language and it will try to answer it.")),1),e("div",J,[e("h1",O,d(s(i)("You can ask questions like:")),1),e("div",R,[(r(),l(v,null,T(M,a=>e("button",{key:a,disabled:!u.featureEnabled,class:"block w-full p-6 text-sm font-normal text-gray-700 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 disabled:cursor-not-allowed",onClick:g=>B(a)},d(a),9,X)),64))])])],64)):p("",!0),s(c)&&s(c).length>0?(r(),l("div",ee,[(r(!0),l(v,null,T(s(c),a=>{var g,h;return r(),l("div",{key:a.id},[a.type=="user"?(r(),l("div",te,[e("div",{class:"px-4 py-2.5 dark:bg-gray-800 bg-gray-300 rounded-full",innerHTML:a.content},null,8,ae)])):(r(),l("div",re,[e("div",null,[y($,{name:"askdb-logo",class:"w-6 h-6 mr-2 text-gray-500 dark:text-gray-400"})]),e("div",null,[e("div",{class:"prose max-w-none lg:max-w-[45vw] dark:prose-invert",innerHTML:a.content},null,8,se),a.usage?(r(),l("p",oe,[e("span",le,d(s(i)("Prompt: :prompt tokens, Completion: :completion tokens",{prompt:(g=a.usage)==null?void 0:g.promptTokens,completion:(h=a.usage)==null?void 0:h.completionTokens})),1)])):p("",!0)])]))])}),128))])):p("",!0)],2),e("div",{id:"form",class:E({"opacity-25":!u.featureEnabled})},[e("div",ne,[e("form",{class:"relative flex w-full",onSubmit:Z(f,["prevent"])},[e("div",ie,[e("div",de,[W(e("textarea",{id:"large-input","onUpdate:modelValue":o[0]||(o[0]=a=>t.prompt=a),name:"prompt",placeholder:s(i)("Enter your query in natural language.."),class:"block w-full h-24 p-3 pr-12 text-gray-800 border-none rounded-lg shadow resize-none bg-gray-50 sm:text-md dark:bg-gray-800 dark:placeholder-gray-400 dark:text-gray-300 focus:outline-none focus:ring-0",disabled:t.loading||!u.featureEnabled,rows:"2",onKeydown:D},null,40,ue),[[j,t.prompt]]),e("button",{type:"submit",disabled:t.loading||!u.featureEnabled,class:"absolute p-2 transition-colors duration-200 ease-in-out rounded-full shadow-sm bottom-2 right-2 bg-light-blue-100 dark:bg-light-blue-800 text-light-blue-600 dark:text-light-blue-300 hover:bg-light-blue-200 dark:hover:bg-light-blue-700 hover:shadow-md disabled:opacity-50"},[y(S,{loading:t.loading,class:"w-5 h-5"},null,8,["loading"]),t.loading?p("",!0):(r(),l("svg",pe,o[2]||(o[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"},null,-1)])))],8,ce)]),e("div",ge,[t.error?(r(),l("p",he,d(t.error),1)):p("",!0),u.appDebug&&t.verboseError?(r(),l("p",me,d(t.verboseError),1)):p("",!0)]),y(s(P),{as:"button",method:"delete",href:n.route("admin.ask-db.reset"),"preserve-state":!1,"preserve-scroll":!1,class:"float-right mt-1.5 text-xs text-gray-600 dark:text-gray-500 hover:text-red-500"},{default:_(()=>[N(d(s(i)("Clear History")),1)]),_:1},8,["href"]),e("p",ye,d(s(i)("This is an experimental feature and still in beta. It may not always provide correct result. Please use with caution.")),1)])],32)])],2)])]),_:1}))}};export{De as default};
