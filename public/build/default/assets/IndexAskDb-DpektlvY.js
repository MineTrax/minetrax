import{m as E,e as V,h as j,p as L,q as P,c as T,w as b,s as W,o as r,b as p,j as s,_ as $,a as t,i as _,t as d,g as f,n as B,d as i,F as k,l as D,f as z,v as N,x as F,P as K}from"./app-CCKLH5ME.js";import{_ as S}from"./AdminLayout-y-VDq6pb.js";import{_ as Y}from"./AppBreadcrumb-B7ASgHLN.js";import{_ as G}from"./AlertCard-DxQ-1NO6.js";import{I as A}from"./Icon-DlyfKWQ8.js";import{r as Q}from"./ExclamationTriangleIcon-Cm4qXIhO.js";import"./useAuthorizable-BcHdws2r.js";import"./CloudArrowDownIcon-C08Kt2Ph.js";import"./BaseLayout-EMqiVgMT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useForwardPropsEmits-Dm3zbijY.js";import"./chevron-down-BttFxFy5.js";import"./Teleport-EbLwDdUQ.js";import"./index-B_t7zORc.js";import"./utils-D-KgF5mV.js";import"./VisuallyHidden-GtrTMWr0.js";import"./x-DbrWVFCU.js";import"./Card-DgOxmuJh.js";import"./CardContent-pSETb6z5.js";import"./XMarkIcon-BFJSCvQG.js";const U={class:"p-10 mx-auto space-y-4 max-w-5xl h-[94vh] flex flex-col"},J={id:"logo",class:"flex items-center justify-center mt-8"},O={class:"text-4xl font-bold text-foreground"},R={class:"text-sm text-center text-muted-foreground"},X={id:"examples"},Z={class:"mt-12 mb-4 text-xl font-bold text-center text-foreground"},ee={class:"grid grid-cols-2 gap-4"},te=["disabled","onClick"],oe={key:1,id:"results",class:"space-y-8 text-foreground"},se={key:0,class:"flex justify-end w-full"},re=["innerHTML"],ae={key:1,class:"flex w-full"},ne={class:"flex-shrink-0"},ie={class:"flex-1 min-w-0"},le=["innerHTML"],de={key:0,class:"text-xs text-muted-foreground mt-1 italic"},ce={class:"relative"},ue=["placeholder","disabled"],me=["disabled"],pe={key:0,class:"animate-spin w-5 h-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},fe={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},he={class:"mt-2"},be={key:0,class:"text-sm text-right text-destructive"},ge={key:1,class:"p-3 text-sm text-center text-destructive bg-destructive/10 rounded-lg"},xe={class:"flex items-center justify-between mt-2"},ye={class:"hidden lg:block text-xs text-muted-foreground"},ze={__name:"IndexAskDb",props:{featureEnabled:{type:Boolean,required:!0},appDebug:{type:Boolean,required:!0},chatHistory:{type:Array,default:()=>[]}},setup(c){const{__:a}=W(),C=[{text:a("Admin"),current:!1},{text:a("Ask DB"),current:!0}],x=c,e=E({prompt:null,loading:!1,error:null,verboseError:null}),H=V(()=>!u.length&&e.loading===!1);let u=E(x.chatHistory);function y(){if(!x.featureEnabled||e.loading||!e.prompt)return;e.loading=!0,e.error=null,e.verboseError=null,u.push({type:"user",content:e.prompt}),v();const l=e.prompt;e.prompt=null,axios.post(route("admin.ask-db.query"),{prompt:l}).then(n=>{u.push(n.data.data)}).catch(n=>{var o,m,h,w;e.error=((m=(o=n.response)==null?void 0:o.data)==null?void 0:m.message)||n.message||a("Failed to Query Database! Try again after rephrasing your question."),x.appDebug&&(e.verboseError=((w=(h=n.response)==null?void 0:h.data)==null?void 0:w.verbose)||null),e.prompt=l,u.pop()}).finally(()=>{e.loading=!1,v()})}function q(l){l&&(e.loading||(e.prompt=l,y()))}function M(l){l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),y())}const I=["Who is the most recent user to signup?","Give 5 recent users who have linked their players.","Which player has the most player kills?","Which server has most number of players?","How many user have their email verified?","How many post is created by superadmin?"],g=j(null);L(()=>{v()});function v(){g.value&&P(()=>{g.value.scrollTo({top:g.value.scrollHeight,behavior:"smooth"})})}return(l,n)=>(r(),T(S,null,{default:b(()=>[p($,{title:s(a)("AskDB - AI based database query.")},null,8,["title"]),t("div",U,[p(Y,{class:"mt-0","breadcrumb-class":"max-w-none px-0 md:px-0",items:C}),c.featureEnabled?f("",!0):(r(),T(G,{key:0,variant:"destructive"},{icon:b(()=>[p(s(Q),{class:"h-6 w-6 mr-4 text-destructive"})]),body:b(()=>[_(d(s(a)("Please configure AI & AskDB in .env file to enable this feature.")),1)]),default:b(()=>[_(" "+d(s(a)("This feature is not enabled!"))+" ",1)]),_:1})),t("div",{id:"container",ref_key:"container",ref:g,class:B(["pr-2 overflow-y-auto grow",{"opacity-25":!c.featureEnabled}])},[H.value?(r(),i(k,{key:0},[t("div",J,[p(A,{name:"askdb-logo",class:"w-16 h-16 mr-2 text-foreground"}),t("h1",O,d(s(a)("Ask DB")),1)]),t("p",R,d(s(a)("Ask DB is an AI based database query system. You can ask questions in natural language and it will try to answer it.")),1),t("div",X,[t("h1",Z,d(s(a)("You can ask questions like:")),1),t("div",ee,[(r(),i(k,null,D(I,o=>t("button",{key:o,disabled:!c.featureEnabled,class:"block w-full p-6 text-sm font-normal text-left text-foreground bg-card border border-border rounded-lg shadow-sm hover:bg-accent hover:border-primary/50 transition-colors disabled:cursor-not-allowed disabled:opacity-50",onClick:m=>q(o)},d(o),9,te)),64))])])],64)):f("",!0),s(u)&&s(u).length>0?(r(),i("div",oe,[(r(!0),i(k,null,D(s(u),o=>{var m,h;return r(),i("div",{key:o.id},[o.type=="user"?(r(),i("div",se,[t("div",{class:"px-4 py-2.5 bg-primary text-primary-foreground rounded-2xl",innerHTML:o.content},null,8,re)])):(r(),i("div",ae,[t("div",ne,[p(A,{name:"askdb-logo",class:"w-6 h-6 mr-3 text-primary"})]),t("div",ie,[t("div",{class:"prose max-w-none lg:max-w-[45vw] dark:prose-invert",innerHTML:o.content},null,8,le),o.usage?(r(),i("p",de,d(s(a)("Prompt: :prompt tokens, Completion: :completion tokens",{prompt:(m=o.usage)==null?void 0:m.promptTokens,completion:(h=o.usage)==null?void 0:h.completionTokens})),1)):f("",!0)])]))])}),128))])):f("",!0)],2),t("div",{id:"form",class:B({"opacity-25":!c.featureEnabled})},[t("form",{class:"w-full",onSubmit:z(y,["prevent"])},[t("div",ce,[N(t("textarea",{id:"large-input","onUpdate:modelValue":n[0]||(n[0]=o=>e.prompt=o),name:"prompt",placeholder:s(a)("Enter your query in natural language.."),class:"block w-full h-24 p-4 pr-14 text-foreground border border-border rounded-lg shadow-sm resize-none bg-card placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50",disabled:e.loading||!c.featureEnabled,rows:"2",onKeydown:M},null,40,ue),[[F,e.prompt]]),t("button",{type:"submit",disabled:e.loading||!c.featureEnabled,class:"absolute p-2.5 transition-colors duration-200 ease-in-out rounded-lg bottom-3 right-3 bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed"},[e.loading?(r(),i("svg",pe,n[1]||(n[1]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(r(),i("svg",fe,n[2]||(n[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"},null,-1)])))],8,me)]),t("div",he,[e.error?(r(),i("p",be,d(e.error),1)):f("",!0),c.appDebug&&e.verboseError?(r(),i("p",ge,d(e.verboseError),1)):f("",!0)]),t("div",xe,[t("p",ye,d(s(a)("This is an experimental feature and still in beta. It may not always provide correct result. Please use with caution.")),1),p(s(K),{as:"button",method:"delete",href:l.route("admin.ask-db.reset"),"preserve-state":!1,"preserve-scroll":!1,class:"text-xs text-muted-foreground hover:text-destructive transition-colors"},{default:b(()=>[_(d(s(a)("Clear History")),1)]),_:1},8,["href"])])],32)],2)])]),_:1}))}};export{ze as default};
